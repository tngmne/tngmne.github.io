<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meal Selection</title>
  <style>
    :root {
      --zebra-black: #222222;
      --zebra-white: #ffffff;
      --zebra-stripe: #f8f9fa;
      --zebra-accent: #3d7dca;
      --zebra-success: #2ecc71;
      --zebra-danger: #e74c3c;
      --zebra-gray: #6c757d;
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 8px rgba(0,0,0,0.12);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      text-align: center;
      padding: 20px;
      background: var(--zebra-stripe);
      color: var(--zebra-black);
      line-height: 1.6;
    }

    h1 {
      margin-bottom: 2rem;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--zebra-accent);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .meal-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
    }

    .option {
      background-color: var(--zebra-white);
      border: none;
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      height: 480px;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .option:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .option img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: var(--radius-md);
      margin-bottom: 1rem;
      cursor: pointer;
      flex-shrink: 0;
    }

    .option-title {
      font-weight: 600;
      font-size: 1.25rem;
      margin-bottom: 0.75rem;
      color: var(--zebra-black);
      flex-shrink: 0;
      line-height: 1.1;
    }

    .description {
      color: var(--zebra-gray);
      flex-grow: 1;
      margin-bottom: 1rem;
      padding-right: 0.5rem;
      font-size: 1rem;
      line-height: 1.5;
      max-height: 9.9em;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: max-height 0.3s ease;
    }

    .description::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0.5rem;
      height: 1.5em;
      background: linear-gradient(transparent, var(--zebra-white));
      pointer-events: none;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .description.expanded {
      max-height: none;
      overflow-y: auto;
    }

    .description.expanded::after {
      opacity: 0;
    }

    .description::-webkit-scrollbar {
      width: 4px;
    }

    .description::-webkit-scrollbar-thumb {
      background: var(--zebra-accent);
      border-radius: 4px;
    }

    .price {
      color: var(--zebra-accent);
      font-weight: 600;
      font-size: 1.5rem;
      margin-top: auto;
      flex-shrink: 0;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      background: var(--zebra-stripe);
      padding: 0.5rem;
      border-radius: var(--radius-lg);
      flex-shrink: 0;
    }

    .quantity-control button {
      width: 48px;
      height: 48px;
      font-size: 1.5rem;
      border: none;
      background: var(--zebra-white);
      color: var(--zebra-accent);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
    }

    .quantity-control button:active {
      transform: scale(0.95);
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    .quantity-control .quantity {
      font-size: 1.5rem;
      min-width: 40px;
      text-align: center;
      font-weight: 600;
      color: var(--zebra-black);
    }

    #totalPrice {
      position: sticky;
      bottom: 5.5rem;
      background: var(--zebra-white);
      padding: 1rem 2rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      margin: 1.5rem auto;
      max-width: 300px;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--zebra-accent);
      z-index: 10;
    }

    .action-buttons {
      position: sticky;
      bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 2rem auto;
      width: 100%;
      max-width: 1400px;
      padding: 0 1rem;
      z-index: 10;
    }

    #resetBtn {
      background: var(--zebra-danger);
      color: var(--zebra-white);
      margin-right: auto;
    }

    #continueBtn {
      background: var(--zebra-accent);
      color: var(--zebra-white);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    #continueBtn:disabled {
      background: var(--zebra-gray);
      cursor: not-allowed;
      opacity: 0.7;
    }

    button {
      padding: 1rem 2rem;
      font-size: 1.125rem;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    #paymentBtn {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    .hidden {
      display: none !important;
    }

    .step {
      background: var(--zebra-white);
      padding: 2rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      margin: 2rem auto;
      max-width: 600px;
      font-size: 1.125rem;
    }

    .step label {
      font-weight: 500;
      color: var(--zebra-black);
      margin-bottom: 0.5rem;
      display: block;
    }

    input[type="text"] {
      padding: 1rem;
      font-size: 1.125rem;
      border: 2px solid var(--zebra-stripe);
      border-radius: var(--radius-sm);
      width: 100%;
      max-width: 300px;
      transition: border-color 0.2s ease;
      background: var(--zebra-white);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--zebra-accent);
      box-shadow: 0 0 0 3px rgba(61, 125, 202, 0.2);
    }

    .payment-options {
      margin-top: 1.5rem;
    }

    .payment-options button {
      margin: 0.5rem;
      padding: 1rem 2rem;
      font-size: 1.125rem;
      border-radius: var(--radius-md);
      border: 2px solid var(--zebra-accent);
      background: var(--zebra-white);
      color: var(--zebra-accent);
      transition: all 0.2s ease;
    }

    .payment-options button:hover {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    .time-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
      margin: 1rem 0;
    }

    .time-buttons button {
      padding: 0.75rem;
      font-size: 1rem;
      border: 2px solid var(--zebra-accent);
      background: var(--zebra-white);
      color: var(--zebra-accent);
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .time-buttons button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: var(--zebra-gray);
      color: var(--zebra-white);
      border-color: var(--zebra-gray);
    }

    .time-buttons button:hover:not(.selected) {
      background: var(--zebra-stripe);
    }

    .time-buttons button.selected {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    #roomPopup {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .popup-content {
      background: var(--zebra-white);
      padding: 2rem;
      border-radius: var(--radius-lg);
      max-height: 90vh;
      overflow-y: auto;
      width: 90%;
      max-width: 600px;
      box-shadow: var(--shadow-md);
      position: relative;
    }

    .room-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .room-grid button {
      padding: 1rem;
      font-size: 1rem;
      border-radius: var(--radius-sm);
      border: 2px solid var(--zebra-accent);
      background: var(--zebra-white);
      color: var(--zebra-accent);
      transition: all 0.2s ease;
    }

    .room-grid button:hover {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    .close-btn {
      margin-top: 1.5rem;
      background: var(--zebra-danger);
      color: var(--zebra-white);
      width: 100%;
    }

    #roomNumber {
      background: var(--zebra-stripe);
      cursor: pointer;
    }

    #receiptModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .receipt-content {
      background: var(--zebra-white);
      padding: 2rem;
      border-radius: var(--radius-lg);
      max-width: 500px;
      width: 90%;
      position: relative;
      font-size: 1.125rem;
      line-height: 1.6;
      box-shadow: var(--shadow-md);
    }

    .receipt-header {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--zebra-accent);
      text-align: center;
    }

    .receipt-items {
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .receipt-total {
      font-weight: 600;
      margin: 1rem 0;
      padding-top: 1rem;
      border-top: 2px dashed var(--zebra-stripe);
      color: var(--zebra-accent);
    }

    .receipt-info {
      margin-top: 1rem;
      text-align: left;
      color: var(--zebra-gray);
      background: var(--zebra-stripe);
      padding: 1rem;
      border-radius: var(--radius-sm);
    }

    .pin-section {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 2px solid var(--zebra-stripe);
      text-align: center;
    }

    .pin-section input {
      width: 140px;
      padding: 1rem;
      font-size: 1.25rem;
      border: 2px solid var(--zebra-stripe);
      border-radius: var(--radius-sm);
      text-align: center;
      letter-spacing: 4px;
      margin-top: 0.5rem;
      background: var(--zebra-white);
      transition: all 0.2s ease;
    }

    .pin-section input:focus {
      border-color: var(--zebra-accent);
      outline: none;
      box-shadow: 0 0 0 3px rgba(61, 125, 202, 0.2);
    }

    .pin-section .error {
      color: var(--zebra-danger);
      font-size: 0.875rem;
      margin-top: 0.5rem;
      display: none;
    }

    .receipt-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      color: var(--zebra-gray);
      transition: color 0.2s ease;
    }

    .receipt-close:hover {
      color: var(--zebra-black);
    }

    .room-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      color: var(--zebra-gray);
      transition: color 0.2s ease;
    }

    .room-close:hover {
      color: var(--zebra-black);
    }

    .receipt-confirm {
      background: var(--zebra-success);
      color: var(--zebra-white);
      padding: 1rem 2rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 1.125rem;
      margin-top: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      width: 100%;
      font-weight: 600;
    }

    .receipt-confirm:disabled {
      background: var(--zebra-gray);
      cursor: not-allowed;
      opacity: 0.7;
    }

    .receipt-confirm:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .receipt-confirm:not(:disabled):active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }

    .thanks-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      overflow: auto;
      backdrop-filter: blur(4px);
    }

    .thanks-content {
      background-color: var(--zebra-white);
      margin: 10% auto;
      padding: 2rem;
      border-radius: var(--radius-lg);
      max-width: 500px;
      position: relative;
      animation: modalSlide 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      box-shadow: var(--shadow-lg);
    }

    .thanks-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--zebra-gray);
      cursor: pointer;
      background: none;
      border: none;
      padding: 0.5rem;
      transition: all 0.2s ease;
      border-radius: var(--radius-sm);
    }

    .thanks-close:hover {
      color: var(--zebra-black);
      background: var(--zebra-stripe);
    }

    .thanks-header {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--zebra-accent);
      text-align: center;
    }

    .thanks-message {
      font-size: 1.125rem;
      color: var(--zebra-gray);
      text-align: center;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .thanks-timer {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--zebra-accent);
      text-align: center;
      margin: 1.5rem 0;
      padding: 1rem;
      background: var(--zebra-stripe);
      border-radius: var(--radius-md);
    }

    @keyframes modalSlide {
      from {
        transform: translateY(-2rem);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .location-toggle {
      display: flex;
      gap: 0.5rem;
      margin: 1rem auto;
      background: var(--zebra-stripe);
      border-radius: var(--radius-lg);
      padding: 0.25rem;
      width: fit-content;
      justify-content: center;
    }

    .location-toggle button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: var(--radius-md);
      background: transparent;
      color: var(--zebra-gray);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      font-size: 1.125rem;
      min-width: 100px;
    }

    .location-toggle button.active {
      background: var(--zebra-white);
      color: var(--zebra-accent);
      box-shadow: var(--shadow-sm);
      font-weight: 600;
    }

    .location-toggle button:hover:not(.active) {
      color: var(--zebra-black);
    }

    @media (max-width: 768px) {
      .thanks-content {
        margin: 5% 1rem;
        padding: 1.5rem;
      }

      .thanks-timer {
        font-size: 2rem;
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <h1 id="mealHeading">Meal Selection</h1>

  <div id="mealContainer" class="meal-options"></div>
  <div id="totalPrice">Total: 0 €</div>

  <div class="action-buttons">
    <button id="resetBtn" onclick="resetAll()">Reset</button>
    <button id="continueBtn" disabled onclick="showNextStep()">Continue</button>
  </div>

  <div id="locationStep" class="step hidden">
    <label>Where to eat:</label>
    <div class="location-toggle">
      <button id="roomBtn" onclick="selectLocation('Room')">🗝️ Room</button>
      <button id="restaurantBtn" onclick="selectLocation('Restaurant')">🍽️ Restaurant</button>
    </div>

    <div id="roomNumberContainer" class="hidden">
      <label>Room Number:</label><br>
      <input type="text" id="roomNumber" readonly placeholder="Select a room" onclick="showRoomPopup()">
    </div>

    <label>Select Time to Eat / Deliver:</label>
    <div id="timeButtonsContainer" class="time-buttons"></div>

    <button id="paymentBtn" class="hidden" onclick="showPaymentOptions()">Select Payment Option</button>
  </div>

  <div class="payment-options hidden" id="paymentOptions">
    <label>Payment Method:</label><br>
    <button onclick="showReceiptModal('Cash')">Cash</button>
    <button onclick="showReceiptModal('Card')">Card</button>
  </div>

  <div id="roomPopup">
    <div class="popup-content">
      <button class="room-close" onclick="closeRoomPopup()">×</button>
      <h3>Select Room Number</h3>
      <div id="roomGrid" class="room-grid"></div>
    </div>
  </div>

  <div id="receiptModal">
    <div class="receipt-content">
      <button class="receipt-close" onclick="closeReceiptModal()">×</button>
      <div class="receipt-header">🧾 Receipt</div>
      <div class="receipt-items" id="receiptItems"></div>
      <div class="receipt-total" id="receiptTotal"></div>
      <div class="receipt-info" id="receiptInfo"></div>
      <div class="pin-section">
        <label for="pinInput">Enter Administrator PIN:</label>
        <input type="password" id="pinInput" maxlength="4" placeholder="****" oninput="validatePin(this.value)">
        <div class="error" id="pinError">Incorrect PIN</div>
      </div>
      <button class="receipt-confirm" id="confirmOrderBtn" onclick="confirmAndSendOrder()" disabled>Confirm Order</button>
    </div>
  </div>

  <script>
    const mealContainer = document.getElementById('mealContainer');
    const totalPriceEl = document.getElementById('totalPrice');
    const continueBtn = document.getElementById('continueBtn');
    const locationStep = document.getElementById('locationStep');
    const roomNumberContainer = document.getElementById('roomNumberContainer');
    const roomNumberInput = document.getElementById('roomNumber');
    const paymentBtn = document.getElementById('paymentBtn');
    const paymentOptions = document.getElementById('paymentOptions');
    const timeButtonsContainer = document.getElementById('timeButtonsContainer');
    const roomPopup = document.getElementById('roomPopup');
    const roomGrid = document.getElementById('roomGrid');
    const selectedMeals = {};

    const breakfastMeals = [
      { name: "Scramble with shrimp and hoisin cream", desc: "Delicate scrambled eggs with butter, juicy shrimp with a hint of garlic, and a tangy hoisin cream. Served with a mix of greens in a honey-balsamic dressing, cherry tomatoes, and a brioche bun", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/ryTRiQJ-aOFwAiH-TjvYkWa_prepare.jpeg", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/skrembl-s-krevetkoy-i-avokado" },
      { name: "Benedict with bacon and hollandaise sauce", desc: "Delicate English muffin with poached eggs, crispy bacon, and airy hollandaise sauce with a hint of nutmeg. Served with a mix of greens and spicy arugula in a honey-balsamic dressing and cherry tomatoes", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/IgoPOfX-OgMIJbM-HGylJRl.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/yaichnica-glazunya-s-kolbaskami-i-syrom" },
      { name: "Montenegrian breakfast", desc: "Hearty Balkan-style set: grilled sausages, sunny-side-up eggs, crispy bacon, young potatoes in garlic oil, and farmhouse cheese.", price: 11, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/VBDefRv-fWwMKVy-OQjfLXl.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/fruktovaya-tarelka" },
      { name: "Pancakes with honey and seasonal fruits", desc: "Pancakes with honey and fresh fruits.", price: 7, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/AqINVvH-PeERgoe-OsSIokL.webp", link:"https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/syrniki-klubnika-smetana-karamel" }
    ];

    const dinnerMeals = [
      // Cold appetizers - 4 meals
      { name: "Bruschetta with marinated pear, gorgonzola sauce, and smoked salmon", desc: "A delicate combination of sweet pear with a hint of wine, tangy gorgonzola cream with basil, and tender house-cured smoked salmon.", price: 14, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/bkOlGMH-kjnelHM-mfDtHSU.webp", category: "Cold appetizers" },
      { name: "Bruschetta with squid, hoisin cream, and chuka seaweed", desc: "Exotic bruschetta with squid, marinated chukka seaweed, mildly sweet hoisin cream, paprika oil and marinated edamame beans", price: 14, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/kPlIlIr-RIoylBS-MdRJeyy.webp", category: "Cold appetizers" },
      { name: "Bruschetta with roast beef and aioli cream", desc: "Juicy roast beef on a crispy toast with a smooth cream rich in roasted garlic aroma, spicy arugula, whole grain mustard, and parmesan", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/klbgUfl-sZAFEqw-ELGpaXb.webp", category: "Cold appetizers" },
      { name: "Beef carpaccio with roasted peach", desc: "Tender slices of beef combined with fragrant peach and a balsamic-based dressing.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/hQJrjLD-FCUeSOl-SwubRJb.webp", category: "Cold appetizers" },
      
      // Salads - 3 meals
      { name: "Salad with roast beef, roasted bell pepper, and pimento sauce", desc: "A salad mix with homemade roast beef, dressed with a sauce made from roasted peppers, sun-dried tomatoes, cilantro, honey and grated roasted walnut.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/gIlCFdO-JqsCDsD-yuVJCVA.webp", category: "Salads" },
      { name: "Seafood salad with coconut dressing", desc: "Young squid and fresh shrimp with a salad mix in a coconut-lime dressing based on mascarpone and paprika oil", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/rHCZwwl-tKeXDxy-JvqnwpH.webp", category: "Salads" },
      { name: "Seasonal vegetable salad with Pomorosso dressing", desc: "A mix of seasonal vegetables with a signature sun-dried tomato-based dressing. The freshness of the vegetables is balanced by delicate farmhouse feta cheese and piquant notes of the dressing.", price: 8, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/uXGkxVe-EhzYAYC-VkkDRml.webp", category: "Salads" },
      
      // Soup - 2 meals
      { name: "Fish soup with seafood", desc: "A rich signature-style soup with cilantro and parsley oil, squid, shrimp, and salmon.", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/MFCywVG-yDbTKpF-AHdmJzF.webp", category: "Soup" },
      { name: "Cold beetroot soup with kefir and baby potatoes", desc: "Refreshing cold kefir-based soup with beetroot, presented in a signature style. Served with sautéed young potatoes.", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/DznPacA-DkDuqoH-XkKHkMV.webp", category: "Soup" },
      
      // Risotto - 3 meals
      { name: "Purple risotto with meatballs and parmesan sauce", desc: "A vibrant dish with veal meatballs, prepared using the classic risotto technique and served with a rich cheese sauce.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/LHnLwxt-rlewSoJ-IiFeJGj.webp", category: "Risotto" },
      { name: "Risotto with porcini mushrooms", desc: "Creamy risotto in a mushroom broth with porcini mushrooms, parmesan, and dill oil.", price: 14, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/uDvjFrW-lTwPIvh-woGUzqJ.webp", category: "Risotto" },
      { name: "Tom Yum risotto with shrimp and squid", desc: "An Asian twist on a classic Italian recipe with squid and shrimp. Infused with coconut notes, lime and the tang of Tom Yum.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/qBCShfD-qVSMPLy-MlyJTPi.webp", category: "Risotto" },
      
      // Fish - 3 meals
      { name: "Grilled dorado with vegetable sauté", desc: "Tender grilled dorado paired with a crispy sauté of seasonal vegetables.", price: 25, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/oWXFZBg-QVTFAYS-YVlSlOX.webp", category: "Fish" },
      { name: "Sea bass fillet with celery root cream and Basoro sauce", desc: "Tender sea bass fillet, pan-seared to a golden crust, served on a velvety celery cream with refined Basoro sauce made from white wine, orange, and aromatic spices. Marinated fennel adds the necessary freshness to the dish.", price: 23, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/iIukBbz-aGWrkjI-FxqSzNR.webp", category: "Fish" },
      { name: "Bourbon salmon", desc: "Tender salmon fillet with mashed potatoes and a sweet-and-sour sauce made from bourbon, honey, and chili pepper.", price: 17, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/CDbjitD-DTYXssC-IwVErjL.webp", category: "Fish" },
      
      // Meat - 4 meals
      { name: "Beef medallions with mashed potatoes and porcini mushroom sauce", desc: "Juicy beef medallions with tender mashed potatoes and a rich creamy sauce made from aromatic wild mushrooms and thyme.", price: 24, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/IzKbeVG-VuCjJFC-XAhJoAT.webp", category: "Meat" },
      { name: "Sous-vide chicken with egg noodles and anise teriyaki sauce", desc: "Juicy sous-vide chicken fillet served with egg noodles in a signature anise teriyaki sauce.", price: 15, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/OebmNKU-FJYnCSH-RbAeXIC.webp", category: "Meat" },
      { name: "Pork tenderloin with young potatoes and mashroom sauce", desc: "Tender, juicy pork with roasted young potatoes. Served with mushroom sauce.", price: 17, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/MTDKfku-iJCHCgl-GjEcePk.webp", category: "Meat" },
      { name: "Signature Pljeskavitsa", desc: "A Balkan classic made from a blend of beef and spices, grilled to perfection. Served with homemade pickles and French fries.", price: 15, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/QrinGlH-oDvCCcR-DMymsiH.webp", category: "Meat" },
      
      // Desserts - 2 meals
      { name: "Brownie with dulce de leche cream and caramelized hazelnuts", desc: "Rich chocolate brownie with the most delicate cream made from boiled condensed milk, soaked cherries, and caramelized hazelnuts.", price: 9, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/GRCFMgJ-WVZeYDn-wbmdTQY.webp", category: "Desserts" },
      { name: "Tiramisu", desc: "A classic Italian dessert. Airy mascarpone cream with notes of lime and orange, sponge cake soaked in coffee and amaretto.", price: 9, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/zDiykLg-VklFnkh-BLUdtTz.webp", category: "Desserts" }
    ];

    function selectLocation(location) {
      // Update button states
      const roomBtn = document.getElementById('roomBtn');
      const restaurantBtn = document.getElementById('restaurantBtn');
      
      roomBtn.classList.toggle('active', location === 'Room');
      restaurantBtn.classList.toggle('active', location === 'Restaurant');
      
      // Store selected location
      window.selectedLocation = location;
      
      // Show/hide room selection
      const showRoom = location === 'Room';
      roomNumberContainer.classList.toggle("hidden", !showRoom);
      if (showRoom) showRoomPopup();
      
      checkForPayment();
    }

    function showRoomPopup() {
      roomPopup.style.display = "flex";
    }

    function closeRoomPopup() {
      roomPopup.style.display = "none";
    }

    function toggleDescription(descriptionElement) {
      descriptionElement.classList.toggle('expanded');
    }

    function selectRoom(number) {
      roomNumberInput.value = number;
      closeRoomPopup();
      checkForPayment();
    }

    function loadRoomButtons() {
      // Define available room ranges
      const roomRanges = [
        { floor: 1, start: 1, end: 15 },  // 101-115
        { floor: 2, start: 1, end: 15 },  // 201-215
        { floor: 3, start: 1, end: 14 },  // 301-314
        { floor: 4, start: 1, end: 14 },  // 401-414
        { floor: 5, start: 1, end: 13 },  // 501-513
        { floor: 6, start: 1, end: 13 },  // 601-613
        { floor: 7, start: 1, end: 13 },  // 701-713
        { floor: 8, start: 1, end: 13 },  // 801-813
        { floor: 9, start: 1, end: 7 },   // 901-907
        { floor: 10, start: 1, end: 7 },  // 1001-1007
        { floor: 11, start: 1, end: 10 }, // 1101-1110
        { floor: 12, start: 1, end: 7 },  // 1201-1207
        { floor: 13, start: 1, end: 3 }   // 1301-1303
      ];
      
      roomRanges.forEach(range => {
        for (let i = range.start; i <= range.end; i++) {
          const roomNumber = range.floor * 100 + i;
          const btn = document.createElement('button');
          btn.textContent = roomNumber;
          btn.onclick = () => selectRoom(roomNumber);
          roomGrid.appendChild(btn);
        }
      });
    }

    function updateQuantity(name, price, action, button) {
      const quantitySpan = button.parentElement.querySelector('.quantity');
      let value = parseInt(quantitySpan.textContent);
      
      if (action === 'increase' && value < 5) {
        value++;
      } else if (action === 'decrease' && value > 0) {
        value--;
      }
      
      quantitySpan.textContent = value;
      
      if (value > 0) {
        selectedMeals[name] = { qty: value, price };
      } else {
        delete selectedMeals[name];
      }

      let total = 0;
      for (let item of Object.values(selectedMeals)) {
        total += item.qty * item.price;
      }

      totalPriceEl.textContent = `Total: ${total} €`;
      continueBtn.disabled = total === 0;
    }

    function showNextStep() {
      locationStep.classList.remove('hidden');
      // Select Restaurant by default
      selectLocation('Restaurant');
      window.scrollTo({ top: locationStep.offsetTop, behavior: "smooth" });
    }

    function checkForPayment() {
      const location = window.selectedLocation;
      const room = roomNumberInput.value;
      const selectedTime = document.querySelector('.time-buttons button.selected');

      const ready = location && selectedTime && (
        location === "Restaurant" || (location === "Room" && room.trim() !== "")
      );

      const wasHidden = paymentBtn.classList.contains("hidden");
      paymentBtn.classList.toggle("hidden", !ready);
      
      // If payment button just became visible and was triggered by time selection, scroll to it
      if (ready && wasHidden && selectedTime) {
        setTimeout(() => {
          paymentBtn.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
        }, 100);
      }
    }

    function showPaymentOptions() {
      paymentOptions.classList.remove("hidden");
      window.scrollTo({ top: paymentOptions.offsetTop, behavior: "smooth" });
    }

    function validatePin(value) {
      const confirmBtn = document.getElementById('confirmOrderBtn');
      const pinError = document.getElementById('pinError');
      
      if (value === '2606') {
        confirmBtn.disabled = false;
        pinError.style.display = 'none';
      } else {
        confirmBtn.disabled = true;
        if (value.length === 4) {
          pinError.style.display = 'block';
        } else {
          pinError.style.display = 'none';
        }
      }
    }

    function generateOrderNumber() {
      const timestamp = Date.now();
      return `ORDER-${timestamp}`;
    }

    function showReceiptModal(method) {
      const receiptModal = document.getElementById('receiptModal');
      const receiptItems = document.getElementById('receiptItems');
      const receiptTotal = document.getElementById('receiptTotal');
      const receiptInfo = document.getElementById('receiptInfo');
      const pinInput = document.getElementById('pinInput');
      const confirmBtn = document.getElementById('confirmOrderBtn');
      const pinError = document.getElementById('pinError');

      // Generate unique order number
      const orderNumber = generateOrderNumber();

      // Reset PIN input and button state
      pinInput.value = '';
      confirmBtn.disabled = true;
      pinError.style.display = 'none';
      
      // Clear previous content
      receiptItems.innerHTML = '';
      
      // Add order number at the top
      receiptItems.innerHTML = `<div style="font-weight: bold; margin-bottom: 10px;">Order #: ${orderNumber}</div>`;
      
      // Add items
      let total = 0;
      for (let [name, item] of Object.entries(selectedMeals)) {
        const itemTotal = item.qty * item.price;
        total += itemTotal;
        receiptItems.innerHTML += `<div>${name} x${item.qty} = ${itemTotal} €</div>`;
      }
      
      // Add total
      receiptTotal.textContent = `Total: ${total} €`;
      
      // Add info
      const time = document.querySelector('.time-buttons button.selected')?.textContent || "N/A";
      const location = window.selectedLocation || "N/A";
      const room = location === "Room" ? roomNumberInput.value : "N/A";
      
      receiptInfo.innerHTML = `
        <div>Time: ${time}</div>
        <div>Location: ${location}</div>
        ${location === "Room" ? `<div>Room: ${room}</div>` : ''}
        <div>Payment Method: ${method}</div>
      `;
      
      // Store the receipt data for later use when sending to Telegram
      receiptModal.dataset.receipt = JSON.stringify({
        orderNumber,
        items: selectedMeals,
        total,
        time,
        location,
        room,
        method
      });
      
      // Show modal
      receiptModal.style.display = 'flex';
    }
    
    function closeReceiptModal() {
      const receiptModal = document.getElementById('receiptModal');
      const pinInput = document.getElementById('pinInput');
      const pinError = document.getElementById('pinError');
      const confirmBtn = document.getElementById('confirmOrderBtn');
      
      receiptModal.style.display = 'none';
      pinInput.value = '';
      pinError.style.display = 'none';
      confirmBtn.disabled = true;
    }
    
    function confirmAndSendOrder() {
      const receiptModal = document.getElementById('receiptModal');
      const receiptData = JSON.parse(receiptModal.dataset.receipt);
      
      // Format receipt for Telegram
      let receipt = `🧾 Receipt\nOrder #: ${receiptData.orderNumber}\n\n`;
      for (let [name, item] of Object.entries(receiptData.items)) {
        receipt += `${name} x${item.qty} = ${item.qty * item.price} €\n`;
      }
      receipt += `\nTotal: ${receiptData.total} €`;
      receipt += `\nTime: ${receiptData.time}`;
      receipt += `\nLocation: ${receiptData.location}`;
      if (receiptData.location === "Room") receipt += `\nRoom: ${receiptData.room}`;
      receipt += `\nPayment Method: ${receiptData.method}`;
      
      // Close modal
      closeReceiptModal();
      
      // Send to Telegram
      const BOT_TOKEN = '8071098931:AAFz_EOIJDp7RrJczbimuIE-sZmXnMPjOi0';
      const CHAT_ID = '1138899345';    // Your chat ID
      
      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: receipt,
          parse_mode: 'HTML',
          reply_markup: JSON.stringify({
            inline_keyboard: [
              [{
                text: '✅ Confirm Order',
                callback_data: 'confirm_order'
              }],
              [{
                text: '❌ Reject Order',
                callback_data: 'reject_order'
              }]
            ]
          })
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          alert('Order sent successfully! We will process it shortly.');
          // Reset the page after successful order
          resetAll();
        } else {
          alert('Error sending order. Please try again or contact us directly.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error sending order. Please try again or contact us directly.');
      });
    }

    function loadTimeButtons() {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();
      const currentTotalMinutes = currentHour * 60 + currentMinute;
      
      let hour = 0, minute = 0;
      while (hour < 24) {
        const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        const timeInMinutes = hour * 60 + minute;
        const btn = document.createElement('button');
        btn.textContent = timeStr;
        
        // Disable if time has passed
        const timePassed = timeInMinutes <= currentTotalMinutes;
        
        // Disable dinner hours (12:31 PM - 11:30 PM) during breakfast time
        const isDinnerSlot = timeInMinutes >= 751 && timeInMinutes <= 1410;
        const isBreakfastTime = currentTotalMinutes <= 750;
        const disableDinnerSlots = isBreakfastTime && isDinnerSlot;
        
        // Disable breakfast hours (00:00 - 12:30 PM) during dinner time
        const isBreakfastSlot = timeInMinutes <= 750;
        const isDinnerTime = currentTotalMinutes >= 751;
        const disableBreakfastSlots = isDinnerTime && isBreakfastSlot;
        
        if (timePassed || disableDinnerSlots || disableBreakfastSlots) {
          btn.disabled = true;
          btn.style.opacity = '0.5';
          btn.style.cursor = 'not-allowed';
        } else {
          btn.onclick = () => {
            document.querySelectorAll('.time-buttons button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            checkForPayment();
          };
        }
        
        timeButtonsContainer.appendChild(btn);

        minute += 30;
        if (minute >= 60) {
          minute = 0;
          hour++;
        }
      }
    }

    function resetAll() {
      // Reset meal selections
      const quantitySpans = document.querySelectorAll('.quantity-control .quantity');
      quantitySpans.forEach(span => {
        span.textContent = '0';
        const optionDiv = span.closest('.option');
        const name = optionDiv.querySelector('.option-title').textContent;
        const price = parseFloat(optionDiv.querySelector('.price').textContent);
        delete selectedMeals[name];
      });

      // Reset location selection
      const roomBtn = document.getElementById('roomBtn');
      const restaurantBtn = document.getElementById('restaurantBtn');
      if (roomBtn) roomBtn.classList.remove('active');
      if (restaurantBtn) restaurantBtn.classList.remove('active');
      window.selectedLocation = null;

      // Reset room number
      if (roomNumberInput) {
        roomNumberInput.value = '';
        roomNumberContainer.classList.add('hidden');
      }

      // Reset time selection
      const timeButtons = document.querySelectorAll('.time-buttons button');
      timeButtons.forEach(btn => btn.classList.remove('selected'));

      // Hide subsequent steps
      locationStep.classList.add('hidden');
      paymentBtn.classList.add('hidden');
      paymentOptions.classList.add('hidden');

      // Reset total price
      totalPriceEl.textContent = 'Total: 0 €';
      
      // Disable continue button
      continueBtn.disabled = true;

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function loadMeals() {
      const now = new Date();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();

      // Breakfast available until 12:30 PM (750 minutes)
      // Dinner available from 12:31 PM (751 minutes) till 23:30 PM (1410 minutes)
      const isBreakfast = currentMinutes <= 750;
      const isDinner = currentMinutes >= 751 && currentMinutes <= 1410;
      
      if (!isBreakfast && !isDinner) {
        mealContainer.innerHTML = "<p>Meal selection is currently unavailable. Breakfast is available until 12:30 PM, dinner from 12:31 PM till 11:30 PM.</p>";
        return;
      }

      document.getElementById("mealHeading").textContent = isBreakfast ? "Select Your Breakfast" : "Select Your Meal";

      if (isBreakfast) {
        // Load breakfast meals as before
        breakfastMeals.forEach(item => {
          const div = document.createElement('div');
          div.className = 'option';
          const imgHTML = item.link
            ? `<img src="${item.img}" alt="${item.name}" onclick="window.open('${item.link}', '_blank')">`
            : `<img src="${item.img}" alt="${item.name}">`;
          div.innerHTML = `
            ${imgHTML}
            <div class="option-title">${item.name}</div>
            <div class="description" onclick="toggleDescription(this)">${item.desc}</div>
            <div class="price">${item.price} €</div>
            <div class="quantity-control">
              <button onclick="updateQuantity('${item.name}', ${item.price}, 'decrease', this)">−</button>
              <span class="quantity">0</span>
              <button onclick="updateQuantity('${item.name}', ${item.price}, 'increase', this)">+</button>
            </div>
          `;
          mealContainer.appendChild(div);
        });
      } else {
        // Load dinner meals organized by categories
        const categories = [
          "Cold appetizers",
          "Salads", 
          "Soup",
          "Risotto",
          "Fish",
          "Meat",
          "Desserts"
        ];
        
        categories.forEach(category => {
          const categoryItems = dinnerMeals.filter(item => item.category === category);
          
          if (categoryItems.length > 0) {
            // Add category header
            const categoryHeader = document.createElement('div');
            categoryHeader.style.cssText = `
              grid-column: 1 / -1;
              font-size: 1.5rem;
              font-weight: 700;
              color: var(--zebra-accent);
              text-align: center;
              margin: 2rem 0 1rem 0;
              padding: 1rem;
              background: var(--zebra-white);
              border-radius: var(--radius-lg);
              box-shadow: var(--shadow-sm);
            `;
            categoryHeader.textContent = category;
            mealContainer.appendChild(categoryHeader);
            
            // Add items in this category
            categoryItems.forEach(item => {
              const div = document.createElement('div');
              div.className = 'option';
              const imgHTML = item.link
                ? `<img src="${item.img}" alt="${item.name}" onclick="window.open('${item.link}', '_blank')">`
                : `<img src="${item.img}" alt="${item.name}">`;
              div.innerHTML = `
                ${imgHTML}
                <div class="option-title">${item.name}</div>
                <div class="description" onclick="toggleDescription(this)">${item.desc}</div>
                <div class="price">${item.price} €</div>
                <div class="quantity-control">
                  <button onclick="updateQuantity('${item.name}', ${item.price}, 'decrease', this)">−</button>
                  <span class="quantity">0</span>
                  <button onclick="updateQuantity('${item.name}', ${item.price}, 'increase', this)">+</button>
                </div>
              `;
              mealContainer.appendChild(div);
            });
          }
        });
      }
    }

    loadMeals();
    loadTimeButtons();
    loadRoomButtons();
  </script>
</body>
</html>
