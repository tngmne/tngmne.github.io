<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meal Selection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background: #f7f7f7;
    }

    h1 {
      margin-bottom: 20px;
      font-size: 28px;
    }

    .meal-options {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .option {
      background-color: white;
      border: 2px solid #ccc;
      border-radius: 10px;
      padding: 20px;
      width: 280px;
      height: 450px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .option img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .option-title {
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 10px;
      flex-shrink: 0;
    }

    .description {
      flex-grow: 1;
      overflow-y: auto;
      margin-bottom: 15px;
    }

    .price {
      color: #333;
      font-weight: bold;
      font-size: 18px;
      margin-top: auto;
      flex-shrink: 0;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
      flex-shrink: 0;
    }

    .quantity-control button {
      width: 44px;
      height: 44px;
      font-size: 24px;
      border: 1px solid #007BFF;
      background-color: white;
      color: #007BFF;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      transition: all 0.2s ease;
    }

    .quantity-control button:active {
      background-color: #007BFF;
      color: white;
      transform: scale(0.95);
    }

    .quantity-control .quantity {
      font-size: 24px;
      min-width: 40px;
      text-align: center;
      font-weight: bold;
      color: #333;
    }

    #totalPrice {
      margin-top: 25px;
      font-size: 22px;
      font-weight: bold;
    }

    button {
      padding: 16px 28px;
      font-size: 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #continueBtn, #paymentBtn {
      margin-top: 30px;
      background-color: #007BFF;
      color: white;
    }

    #continueBtn:disabled {
      background-color: #aaa;
      cursor: not-allowed;
    }

    #resetBtn {
      margin-top: 30px;
      margin-left: 10px;
      background-color: #dc3545;
      color: white;
    }

    .hidden {
      display: none;
    }

    .step {
      margin-top: 30px;
      font-size: 18px;
    }

    input[type="text"] {
      padding: 10px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin-top: 10px;
      width: 220px;
    }

    .payment-options {
      margin-top: 20px;
    }

    .payment-options button {
      margin: 10px;
      padding: 14px 24px;
      font-size: 18px;
      border-radius: 6px;
      border: 1px solid #007BFF;
    }

    .time-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    .time-buttons button {
      padding: 12px 20px;
      font-size: 16px;
      border: 1px solid #007BFF;
      background-color: white;
      color: #007BFF;
    }

    .time-buttons button.selected {
      background-color: #007BFF;
      color: white;
    }

    #roomPopup {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .popup-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-height: 90vh;
      overflow-y: auto;
      max-width: 500px;
    }

    .room-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .room-grid button {
      padding: 12px;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #007BFF;
      background-color: #f0f0f0;
    }

    .close-btn {
      margin-top: 15px;
      background: #dc3545;
      color: white;
    }

    #roomNumber {
      background-color: #eee;
    }

    #receiptModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .receipt-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      max-width: 400px;
      width: 90%;
      position: relative;
      font-size: 18px;
      line-height: 1.5;
    }

    .receipt-header {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 20px;
      color: #333;
    }

    .receipt-items {
      margin-bottom: 20px;
      text-align: left;
    }

    .receipt-total {
      font-weight: bold;
      margin: 15px 0;
      padding-top: 15px;
      border-top: 2px dashed #ccc;
    }

    .receipt-info {
      margin-top: 15px;
      text-align: left;
      color: #666;
    }

    .pin-section {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .pin-section input {
      width: 120px;
      padding: 8px 12px;
      font-size: 18px;
      border: 2px solid #ccc;
      border-radius: 4px;
      text-align: center;
      letter-spacing: 2px;
      margin-top: 8px;
    }

    .pin-section input:focus {
      border-color: #007BFF;
      outline: none;
    }

    .pin-section .error {
      color: #dc3545;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }

    .receipt-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      color: #666;
    }

    .receipt-close:hover {
      color: #333;
    }

    .receipt-confirm {
      background-color: #28a745;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 5px;
      font-size: 18px;
      margin-top: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .receipt-confirm:disabled {
      background-color: #a8d5b3;
      cursor: not-allowed;
      transform: scale(0.98);
      opacity: 0.8;
    }

    .receipt-confirm:not(:disabled):hover {
      background-color: #218838;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .receipt-confirm:not(:disabled):active {
      transform: translateY(0);
      box-shadow: none;
    }
  </style>
</head>
<body>
  <h1 id="mealHeading">Meal Selection</h1>

  <div id="mealContainer" class="meal-options"></div>
  <div id="totalPrice">Total: 0 €</div>

  <button id="continueBtn" disabled onclick="showNextStep()">Continue</button>
  <button id="resetBtn" onclick="resetAll()">Reset</button>

  <div id="locationStep" class="step hidden">
    <label>Where to eat:</label><br>
    <input type="radio" name="location" value="Room" onclick="toggleRoom(true)"> Room
    <input type="radio" name="location" value="Restaurant" onclick="toggleRoom(false)"> Restaurant

    <div id="roomNumberContainer" class="hidden">
      <label>Room Number:</label><br>
      <input type="text" id="roomNumber" readonly placeholder="Select a room" onclick="showRoomPopup()">
    </div>

    <label>Select Time to Eat / Deliver:</label>
    <div id="timeButtonsContainer" class="time-buttons"></div>

    <button id="paymentBtn" class="hidden" onclick="showPaymentOptions()">Select Payment Option</button>
  </div>

  <div class="payment-options hidden" id="paymentOptions">
    <label>Payment Method:</label><br>
    <button onclick="showReceiptModal('Cash')">Cash</button>
    <button onclick="showReceiptModal('Card')">Card</button>
  </div>

  <div id="roomPopup">
    <div class="popup-content">
      <h3>Select Room Number</h3>
      <div id="roomGrid" class="room-grid"></div>
      <button class="close-btn" onclick="closeRoomPopup()">Close</button>
    </div>
  </div>

  <div id="receiptModal">
    <div class="receipt-content">
      <button class="receipt-close" onclick="closeReceiptModal()">×</button>
      <div class="receipt-header">🧾 Receipt</div>
      <div class="receipt-items" id="receiptItems"></div>
      <div class="receipt-total" id="receiptTotal"></div>
      <div class="receipt-info" id="receiptInfo"></div>
      <div class="pin-section">
        <label for="pinInput">Enter Administrator PIN:</label>
        <input type="password" id="pinInput" maxlength="4" placeholder="****" oninput="validatePin(this.value)">
        <div class="error" id="pinError">Incorrect PIN</div>
      </div>
      <button class="receipt-confirm" id="confirmOrderBtn" onclick="confirmAndSendOrder()" disabled>Confirm Order</button>
    </div>
  </div>

  <script>
    const mealContainer = document.getElementById('mealContainer');
    const totalPriceEl = document.getElementById('totalPrice');
    const continueBtn = document.getElementById('continueBtn');
    const locationStep = document.getElementById('locationStep');
    const roomNumberContainer = document.getElementById('roomNumberContainer');
    const roomNumberInput = document.getElementById('roomNumber');
    const paymentBtn = document.getElementById('paymentBtn');
    const paymentOptions = document.getElementById('paymentOptions');
    const timeButtonsContainer = document.getElementById('timeButtonsContainer');
    const roomPopup = document.getElementById('roomPopup');
    const roomGrid = document.getElementById('roomGrid');
    const selectedMeals = {};

    const breakfastMeals = [
      { name: "Scramble with shrimp and hoisin cream", desc: "Delicate scrambled eggs with butter, juicy shrimp with a hint of garlic, and a tangy hoisin cream. Served with a mix of greens in a honey-balsamic dressing, cherry tomatoes, and a brioche bun", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/ryTRiQJ-aOFwAiH-TjvYkWa_prepare.jpeg", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/skrembl-s-krevetkoy-i-avokado" },
      { name: "Benedict with bacon and hollandaise sauce", desc: "Delicate English muffin with poached eggs, crispy bacon, and airy hollandaise sauce with a hint of nutmeg. Served with a mix of greens and spicy arugula in a honey-balsamic dressing and cherry tomatoes", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/IgoPOfX-OgMIJbM-HGylJRl.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/yaichnica-glazunya-s-kolbaskami-i-syrom" },
      { name: "Montenegrin breakfast", desc: "Hearty Balkan-style set: grilled sausages, sunny-side-up eggs, crispy bacon, young potatoes in garlic oil, and farmhouse cheese.", price: 11, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/VBDefRv-fWwMKVy-OQjfLXl.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/fruktovaya-tarelka" },
      { name: "Pancakes with honey and seasonal fruits", desc: "Pancakes with honey and fresh fruits.", price: 7, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/AqINVvH-PeERgoe-OsSIokL.webp", link:"https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/syrniki-klubnika-smetana-karamel" }
    ];

    const dinnerMeals = [
      { name: "Pork tenderloin with young potatoes and mashroom sauce", desc: "Tender, juicy pork with roasted young potatoes. Served with mushroom sauce", price: 5, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/MTDKfku-iJCHCgl-GjEcePk.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/myaso/svinaya-koreyka-v-limonno-chesnochnom-souse-s-pyure-iz-batata" },
      { name: "Pasta", desc: "Spaghetti with tomato sauce and basil", price: 4, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/zDiykLg-VklFnkh-BLUdtTz_prepare.jpeg" },
      { name: "Seafood", desc: "Grilled salmon, rice, asparagus", price: 6, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/MTDKfku-iJCHCgl-GjEcePk_prepare.jpeg" },
      { name: "Vegan Bowl", desc: "Quinoa, chickpeas, avocado, greens", price: 4, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/iIukBbz-aGWrkjI-FxqSzNR_prepare.jpeg" }
    ];

    function toggleRoom(show) {
      roomNumberContainer.classList.toggle("hidden", !show);
      if (show) showRoomPopup();
      checkForPayment();
    }

    function showRoomPopup() {
      roomPopup.style.display = "flex";
    }

    function closeRoomPopup() {
      roomPopup.style.display = "none";
    }

    function selectRoom(number) {
      roomNumberInput.value = number;
      closeRoomPopup();
      checkForPayment();
    }

    function loadRoomButtons() {
      for (let i = 1; i <= 145; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.onclick = () => selectRoom(i);
        roomGrid.appendChild(btn);
      }
    }

    function updateQuantity(name, price, action, button) {
      const quantitySpan = button.parentElement.querySelector('.quantity');
      let value = parseInt(quantitySpan.textContent);
      
      if (action === 'increase' && value < 5) {
        value++;
      } else if (action === 'decrease' && value > 0) {
        value--;
      }
      
      quantitySpan.textContent = value;
      
      if (value > 0) {
        selectedMeals[name] = { qty: value, price };
      } else {
        delete selectedMeals[name];
      }

      let total = 0;
      for (let item of Object.values(selectedMeals)) {
        total += item.qty * item.price;
      }

      totalPriceEl.textContent = `Total: ${total} €`;
      continueBtn.disabled = total === 0;
    }

    function showNextStep() {
      locationStep.classList.remove('hidden');
      window.scrollTo({ top: locationStep.offsetTop, behavior: "smooth" });
    }

    function checkForPayment() {
      const location = document.querySelector('input[name="location"]:checked');
      const room = roomNumberInput.value;
      const selectedTime = document.querySelector('.time-buttons button.selected');

      const ready = location && selectedTime && (
        location.value === "Restaurant" || (location.value === "Room" && room.trim() !== "")
      );

      paymentBtn.classList.toggle("hidden", !ready);
    }

    function showPaymentOptions() {
      paymentOptions.classList.remove("hidden");
      window.scrollTo({ top: paymentOptions.offsetTop, behavior: "smooth" });
    }

    function validatePin(value) {
      const confirmBtn = document.getElementById('confirmOrderBtn');
      const pinError = document.getElementById('pinError');
      
      if (value === '2606') {
        confirmBtn.disabled = false;
        pinError.style.display = 'none';
      } else {
        confirmBtn.disabled = true;
        if (value.length === 4) {
          pinError.style.display = 'block';
        } else {
          pinError.style.display = 'none';
        }
      }
    }

    function generateOrderNumber() {
      const timestamp = Date.now();
      return `ORDER-${timestamp}`;
    }

    function showReceiptModal(method) {
      const receiptModal = document.getElementById('receiptModal');
      const receiptItems = document.getElementById('receiptItems');
      const receiptTotal = document.getElementById('receiptTotal');
      const receiptInfo = document.getElementById('receiptInfo');
      const pinInput = document.getElementById('pinInput');
      const confirmBtn = document.getElementById('confirmOrderBtn');
      const pinError = document.getElementById('pinError');

      // Generate unique order number
      const orderNumber = generateOrderNumber();

      // Reset PIN input and button state
      pinInput.value = '';
      confirmBtn.disabled = true;
      pinError.style.display = 'none';
      
      // Clear previous content
      receiptItems.innerHTML = '';
      
      // Add order number at the top
      receiptItems.innerHTML = `<div style="font-weight: bold; margin-bottom: 10px;">Order #: ${orderNumber}</div>`;
      
      // Add items
      let total = 0;
      for (let [name, item] of Object.entries(selectedMeals)) {
        const itemTotal = item.qty * item.price;
        total += itemTotal;
        receiptItems.innerHTML += `<div>${name} x${item.qty} = ${itemTotal} €</div>`;
      }
      
      // Add total
      receiptTotal.textContent = `Total: ${total} €`;
      
      // Add info
      const time = document.querySelector('.time-buttons button.selected')?.textContent || "N/A";
      const location = document.querySelector('input[name="location"]:checked')?.value || "N/A";
      const room = location === "Room" ? roomNumberInput.value : "N/A";
      
      receiptInfo.innerHTML = `
        <div>Time: ${time}</div>
        <div>Location: ${location}</div>
        ${location === "Room" ? `<div>Room: ${room}</div>` : ''}
        <div>Payment Method: ${method}</div>
      `;
      
      // Store the receipt data for later use when sending to Telegram
      receiptModal.dataset.receipt = JSON.stringify({
        orderNumber,
        items: selectedMeals,
        total,
        time,
        location,
        room,
        method
      });
      
      // Show modal
      receiptModal.style.display = 'flex';
    }
    
    function closeReceiptModal() {
      const receiptModal = document.getElementById('receiptModal');
      const pinInput = document.getElementById('pinInput');
      const pinError = document.getElementById('pinError');
      const confirmBtn = document.getElementById('confirmOrderBtn');
      
      receiptModal.style.display = 'none';
      pinInput.value = '';
      pinError.style.display = 'none';
      confirmBtn.disabled = true;
    }
    
    function confirmAndSendOrder() {
      const receiptModal = document.getElementById('receiptModal');
      const receiptData = JSON.parse(receiptModal.dataset.receipt);
      
      // Format receipt for Telegram
      let receipt = `🧾 Receipt\nOrder #: ${receiptData.orderNumber}\n\n`;
      for (let [name, item] of Object.entries(receiptData.items)) {
        receipt += `${name} x${item.qty} = ${item.qty * item.price} €\n`;
      }
      receipt += `\nTotal: ${receiptData.total} €`;
      receipt += `\nTime: ${receiptData.time}`;
      receipt += `\nLocation: ${receiptData.location}`;
      if (receiptData.location === "Room") receipt += `\nRoom: ${receiptData.room}`;
      receipt += `\nPayment Method: ${receiptData.method}`;
      
      // Close modal
      closeReceiptModal();
      
      // Send to Telegram
      const BOT_TOKEN = '8071098931:AAFz_EOIJDp7RrJczbimuIE-sZmXnMPjOi0';
      const CHAT_ID = '1138899345';    // Your chat ID
      
      fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: receipt,
          parse_mode: 'HTML',
          reply_markup: JSON.stringify({
            inline_keyboard: [
              [{
                text: '✅ Confirm Order',
                callback_data: 'confirm_order'
              }],
              [{
                text: '❌ Reject Order',
                callback_data: 'reject_order'
              }]
            ]
          })
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          alert('Order sent successfully! We will process it shortly.');
        } else {
          alert('Error sending order. Please try again or contact us directly.');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Error sending order. Please try again or contact us directly.');
      });
    }

    function loadTimeButtons() {
      let hour = 0, minute = 30;
      while (hour < 24) {
        const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
        const btn = document.createElement('button');
        btn.textContent = timeStr;
        btn.onclick = () => {
          document.querySelectorAll('.time-buttons button').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          checkForPayment();
        };
        timeButtonsContainer.appendChild(btn);

        minute += 60;
        if (minute >= 60) {
          minute = 0;
          hour++;
        }
      }
    }

    function resetAll() {
      // Reset meal selections
      const quantitySpans = document.querySelectorAll('.quantity-control .quantity');
      quantitySpans.forEach(span => {
        span.textContent = '0';
        const optionDiv = span.closest('.option');
        const name = optionDiv.querySelector('.option-title').textContent;
        const price = parseFloat(optionDiv.querySelector('.price').textContent);
        delete selectedMeals[name];
      });

      // Reset location selection
      const locationRadios = document.querySelectorAll('input[name="location"]');
      locationRadios.forEach(radio => radio.checked = false);

      // Reset room number
      if (roomNumberInput) {
        roomNumberInput.value = '';
        roomNumberContainer.classList.add('hidden');
      }

      // Reset time selection
      const timeButtons = document.querySelectorAll('.time-buttons button');
      timeButtons.forEach(btn => btn.classList.remove('selected'));

      // Hide subsequent steps
      locationStep.classList.add('hidden');
      paymentBtn.classList.add('hidden');
      paymentOptions.classList.add('hidden');

      // Reset total price
      totalPriceEl.textContent = 'Total: 0 €';
      
      // Disable continue button
      continueBtn.disabled = true;

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function loadMeals() {
      const now = new Date();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();

      if (currentMinutes === 720) {
        mealContainer.innerHTML = "<p>Meal selection is temporarily unavailable from 12:00 to 12:01.</p>";
        return;
      }

      const isBreakfast = currentMinutes >= 30 && currentMinutes <= 720;
      const options = isBreakfast ? breakfastMeals : dinnerMeals;
      document.getElementById("mealHeading").textContent = isBreakfast ? "Select Your Breakfast" : "Select Your Dinner";

      options.forEach(item => {
        const div = document.createElement('div');
        div.className = 'option';
        const imgHTML = item.link
          ? `<img src="${item.img}" alt="${item.name}" onclick="window.open('${item.link}', '_blank')">`
          : `<img src="${item.img}" alt="${item.name}">`;
        div.innerHTML = `
          ${imgHTML}
          <div class="option-title">${item.name}</div>
          <div class="description">${item.desc}</div>
          <div class="price">${item.price} €</div>
          <div class="quantity-control">
            <button onclick="updateQuantity('${item.name}', ${item.price}, 'decrease', this)">−</button>
            <span class="quantity">0</span>
            <button onclick="updateQuantity('${item.name}', ${item.price}, 'increase', this)">+</button>
          </div>
        `;
        mealContainer.appendChild(div);
      });
    }

    loadMeals();
    loadTimeButtons();
    loadRoomButtons();
  </script>
</body>
</html>
