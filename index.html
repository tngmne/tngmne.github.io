<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meal Selection</title>
  <style>
    :root {
      --zebra-black: #000000;
      --zebra-white: #ffffff;
      --zebra-stripe: #f0f0f0;
      --zebra-accent: #333333;
      --zebra-success: #666666;
      --zebra-danger: #999999;
      --zebra-gray: #888888;
      --shadow-sm: 0 2px 4px rgba(0,0,0,0.2);
      --shadow-md: 0 4px 8px rgba(0,0,0,0.25);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      text-align: center;
      padding: 20px;
      background: var(--zebra-white);
      color: var(--zebra-black);
      line-height: 1.6;
    }

    h1 {
      margin-bottom: 2rem;
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--zebra-black);
      text-shadow: 1px 1px 2px rgba(255,255,255,0.5);
      border-bottom: 3px solid var(--zebra-black);
      padding-bottom: 1rem;
    }

    .logo {
      display: block;
      width: 100px;
      height: 100px;
      margin: 0 auto 2rem auto;
      background: var(--zebra-white);
      border-radius: 50%;
      padding: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 50%;
    }

    .meal-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1.5rem;
      max-width: 1400px;
      margin: 0 auto;
      padding: 1rem;
    }

    /* Section Navigation Styles */
    .section-navigation {
      background: var(--zebra-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      margin: 1.5rem auto 2rem;
      padding: 1.5rem;
      max-width: 1200px;
      border: 2px solid var(--zebra-accent);
    }
    
    .nav-title {
      text-align: center;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--zebra-accent);
      margin-bottom: 1rem;
    }
    
    .nav-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
      align-items: center;
    }
    
    .nav-button {
      background: linear-gradient(135deg, var(--zebra-white) 0%, var(--zebra-stripe) 100%);
      border: 2px solid var(--zebra-accent);
      border-radius: var(--radius-md);
      padding: 0.75rem 1.25rem;
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--zebra-accent);
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      text-align: center;
      min-width: 120px;
    }
    
    .nav-button:hover {
      background: linear-gradient(135deg, var(--zebra-accent) 0%, var(--zebra-secondary) 100%);
      color: var(--zebra-white);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .nav-button:active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }

    .option {
      background-color: var(--zebra-white);
      border: none;
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      height: 500px;
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .option:hover {
      transform: translateY(-4px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    .option img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: var(--radius-md);
      margin-bottom: 0.75rem;
      cursor: pointer;
      flex-shrink: 0;
    }

    .option-title {
      font-weight: 600;
      font-size: 1.35rem;
      margin-bottom: 0.5rem;
      color: var(--zebra-black);
      flex-shrink: 0;
      line-height: 1.1;
    }

    .description {
      color: var(--zebra-gray);
      flex-grow: 1;
      margin-bottom: 0.75rem;
      padding-right: 0.5rem;
      font-size: 1.1rem;
      line-height: 1.5;
      max-height: 14em;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      transition: max-height 0.3s ease;
      min-height: 40px;
    }

    .description::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0.5rem;
      height: 1.5em;
      background: linear-gradient(transparent, var(--zebra-white));
      pointer-events: none;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    .description.expanded {
      max-height: none;
      overflow-y: auto;
    }

    .description.expanded::after {
      opacity: 0;
    }

    .description::-webkit-scrollbar {
      width: 4px;
    }

    .description::-webkit-scrollbar-thumb {
      background: var(--zebra-accent);
      border-radius: 4px;
    }

    .price {
      color: var(--zebra-accent);
      font-weight: 600;
      font-size: 1.5rem;
      margin-top: auto;
      flex-shrink: 0;
    }

    .quantity-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-top: 0.75rem;
      background: var(--zebra-stripe);
      padding: 0.4rem;
      border-radius: var(--radius-lg);
      flex-shrink: 0;
    }

    .quantity-control button {
      width: 48px;
      height: 48px;
      font-size: 1.5rem;
      border: none;
      background: var(--zebra-white);
      color: var(--zebra-accent);
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s ease;
    }

    .quantity-control button:active {
      transform: scale(0.95);
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    .quantity-control .quantity {
      font-size: 1.5rem;
      min-width: 40px;
      text-align: center;
      font-weight: 600;
      color: var(--zebra-black);
    }

    #totalPrice {
      position: sticky;
      bottom: 7rem;
      background: linear-gradient(135deg, var(--zebra-black), var(--zebra-gray));
      padding: 1.25rem 2.5rem;
      border-radius: var(--radius-lg);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.1);
      margin: 1.5rem auto;
      max-width: 320px;
      font-size: 1.6rem;
      font-weight: 700;
      color: var(--zebra-white);
      z-index: 10;
      text-align: center;
      border: 2px solid rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    #totalPrice:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(61, 125, 202, 0.4), 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .action-buttons {
      position: sticky;
      bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 2rem auto;
      width: 100%;
      max-width: 1400px;
      padding: 0 1rem;
      z-index: 10;
    }

    #resetBtn {
      background: var(--zebra-danger);
      color: var(--zebra-white);
      margin-right: auto;
    }

    #continueBtn {
      background: var(--zebra-accent);
      color: var(--zebra-white);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.5rem;
    }

    #continueBtn:disabled {
      background: var(--zebra-gray);
      cursor: not-allowed;
      opacity: 0.7;
    }

    button {
      padding: 1rem 2rem;
      font-size: 1.125rem;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    #paymentBtn {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    #paymentMethodBtn {
      background: var(--zebra-accent);
      color: var(--zebra-white);
      width: 100%;
      margin-bottom: 1.5rem;
    }

    .hidden {
      display: none !important;
    }

    .step {
      background: var(--zebra-white);
      padding: 2rem;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      margin: 2rem auto;
      max-width: 600px;
      font-size: 1.125rem;
    }

    .step label {
      font-weight: 500;
      color: var(--zebra-black);
      margin-bottom: 0.5rem;
      display: block;
    }

    input[type="text"] {
      padding: 1rem;
      font-size: 1.125rem;
      border: 2px solid var(--zebra-stripe);
      border-radius: var(--radius-sm);
      width: 100%;
      max-width: 300px;
      transition: border-color 0.2s ease;
      background: var(--zebra-white);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--zebra-accent);
      box-shadow: 0 0 0 3px rgba(61, 125, 202, 0.2);
    }

    .payment-label {
      padding: 1.25rem 2.5rem;
      border: none;
      border-radius: var(--radius-md);
      background: transparent;
      color: var(--zebra-accent);
      font-weight: 600;
      font-size: 1.5rem;
      letter-spacing: 0.5px;
      text-align: center;
      margin-bottom: 1rem;
    }

    .section-label {
      padding: 1.25rem 2.5rem;
      border: none;
      border-radius: var(--radius-md);
      background: transparent;
      color: var(--zebra-accent);
      font-weight: 600;
      font-size: 1.5rem;
      letter-spacing: 0.5px;
      text-align: center;
      margin-bottom: 1rem;
    }

    .payment-options {
      margin-top: 1.5rem;
    }

    .payment-options button {
      margin: 0.5rem;
      padding: 1rem 2rem;
      font-size: 1.5rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-radius: var(--radius-md);
      border: 2px solid var(--zebra-accent);
      background: var(--zebra-white);
      color: var(--zebra-accent);
      transition: all 0.2s ease;
    }

    .payment-options button:hover {
      background: var(--zebra-accent);
      color: var(--zebra-white);
      font-weight: 700;
      font-size: 1.6rem;
    }

    .time-buttons {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 0.75rem;
      margin: 1rem 0;
    }

    .time-buttons button {
      padding: 0.75rem;
      font-size: 1rem;
      border: 2px solid var(--zebra-accent);
      background: var(--zebra-white);
      color: var(--zebra-accent);
      border-radius: var(--radius-sm);
      transition: all 0.2s ease;
    }

    .time-buttons button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: var(--zebra-gray);
      color: var(--zebra-white);
      border-color: var(--zebra-gray);
    }

    .time-buttons button:hover:not(.selected) {
      background: var(--zebra-stripe);
    }

    .time-buttons button.selected {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    /* Shake animation for location selector */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }

    .location-toggle.shake {
      animation: shake 0.8s ease-in-out;
    }

    #roomPopup {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .popup-content {
      background: var(--zebra-white);
      padding: 2rem;
      border-radius: var(--radius-lg);
      max-height: 90vh;
      overflow-y: auto;
      width: 90%;
      max-width: 600px;
      box-shadow: var(--shadow-md);
      position: relative;
    }

    .room-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 0.75rem;
      margin-top: 1rem;
    }

    .room-grid button {
      padding: 1rem;
      font-size: 1rem;
      border-radius: var(--radius-sm);
      border: 2px solid var(--zebra-accent);
      background: var(--zebra-white);
      color: var(--zebra-accent);
      transition: all 0.2s ease;
    }

    .room-grid button:hover {
      background: var(--zebra-accent);
      color: var(--zebra-white);
    }

    .close-btn {
      margin-top: 1.5rem;
      background: var(--zebra-danger);
      color: var(--zebra-white);
      width: 100%;
    }

    #roomNumber {
      background: var(--zebra-stripe);
      cursor: pointer;
    }

    #receiptModal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .receipt-content {
      background: var(--zebra-white);
      padding: 2rem;
      border-radius: var(--radius-lg);
      max-width: 500px;
      width: 90%;
      position: relative;
      font-size: 1.125rem;
      line-height: 1.6;
      box-shadow: var(--shadow-md);
    }

    .receipt-header {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--zebra-accent);
      text-align: center;
    }

    .receipt-items {
      margin-bottom: 1.5rem;
      text-align: left;
    }

    .receipt-total {
      font-weight: 600;
      margin: 1rem 0;
      padding-top: 1rem;
      border-top: 2px dashed var(--zebra-stripe);
      color: var(--zebra-accent);
    }

    .receipt-info {
      margin-top: 1rem;
      text-align: left;
      color: var(--zebra-gray);
      background: var(--zebra-stripe);
      padding: 1rem;
      border-radius: var(--radius-sm);
    }

    .pin-section {
      margin-top: 1.5rem;
      padding-top: 1rem;
      border-top: 2px solid var(--zebra-stripe);
      text-align: center;
    }

    .pin-section input {
      width: 140px;
      padding: 1rem;
      font-size: 1.25rem;
      border: 2px solid var(--zebra-stripe);
      border-radius: var(--radius-sm);
      text-align: center;
      letter-spacing: 4px;
      margin-top: 0.5rem;
      background: var(--zebra-white);
      transition: all 0.2s ease;
    }

    .pin-section input:focus {
      border-color: var(--zebra-accent);
      outline: none;
      box-shadow: 0 0 0 3px rgba(61, 125, 202, 0.2);
    }

    .pin-section .error {
      color: var(--zebra-danger);
      font-size: 0.875rem;
      margin-top: 0.5rem;
      display: none;
    }

    .receipt-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      color: var(--zebra-gray);
      transition: color 0.2s ease;
    }

    .receipt-close:hover {
      color: var(--zebra-black);
    }

    .room-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0.5rem;
      color: var(--zebra-gray);
      transition: color 0.2s ease;
    }

    .room-close:hover {
      color: var(--zebra-black);
    }

    .receipt-confirm {
      background: var(--zebra-success);
      color: var(--zebra-white);
      padding: 1rem 2rem;
      border: none;
      border-radius: var(--radius-md);
      font-size: 1.125rem;
      margin-top: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      width: 100%;
      font-weight: 600;
    }

    .receipt-confirm:disabled {
      background: var(--zebra-gray);
      cursor: not-allowed;
      opacity: 0.7;
    }

    .receipt-confirm:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .receipt-confirm:not(:disabled):active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }

    .thanks-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      overflow: auto;
      backdrop-filter: blur(4px);
    }

    .thanks-content {
      background-color: var(--zebra-white);
      margin: 10% auto;
      padding: 2rem;
      border-radius: var(--radius-lg);
      max-width: 500px;
      position: relative;
      animation: modalSlide 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      box-shadow: var(--shadow-lg);
    }

    .thanks-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--zebra-gray);
      cursor: pointer;
      background: none;
      border: none;
      padding: 0.5rem;
      transition: all 0.2s ease;
      border-radius: var(--radius-sm);
    }

    .thanks-close:hover {
      color: var(--zebra-black);
      background: var(--zebra-stripe);
    }

    .thanks-header {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: var(--zebra-accent);
      text-align: center;
    }

    .thanks-message {
      font-size: 1.125rem;
      color: var(--zebra-gray);
      text-align: center;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .thanks-timer {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--zebra-accent);
      text-align: center;
      margin: 1.5rem 0;
      padding: 1rem;
      background: var(--zebra-stripe);
      border-radius: var(--radius-md);
    }

    @keyframes modalSlide {
      from {
        transform: translateY(-2rem);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .location-toggle {
      display: flex;
      gap: 0.5rem;
      margin: 1rem auto;
      background: var(--zebra-stripe);
      border-radius: var(--radius-lg);
      padding: 0.25rem;
      width: fit-content;
      justify-content: center;
    }

    .location-toggle button {
      padding: 1.25rem 2.5rem;
      border: none;
      border-radius: var(--radius-md);
      background: transparent;
      color: var(--zebra-gray);
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 1.5rem;
      min-width: 140px;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .location-toggle button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.6s ease;
    }

    .location-toggle button:hover::before {
      left: 100%;
    }

    .location-toggle button.active {
      background: linear-gradient(135deg, var(--zebra-white) 0%, var(--zebra-stripe) 100%);
      color: var(--zebra-accent);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15), inset 0 1px 0 rgba(255,255,255,0.8);
      font-weight: 700;
      transform: translateY(-3px) scale(1.02);
      font-size: 1.6rem;
      border: 2px solid var(--zebra-accent);
    }

    .location-toggle button:hover:not(.active) {
      color: var(--zebra-black);
      background: linear-gradient(135deg, rgba(255,255,255,0.8) 0%, rgba(248,249,250,0.8) 100%);
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 4px 15px rgba(0,0,0,0.12);
      font-size: 1.55rem;
    }



    /* Version display styling */
    .version-info {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.375rem;
      font-family: 'Courier New', monospace;
      z-index: 1000;
      opacity: 0.8;
      transition: opacity 0.3s ease;
      cursor: pointer;
    }

    .version-info:hover {
      opacity: 1;
      background: rgba(0, 0, 0, 0.9);
    }
  </style>
</head>
<body>
  <!-- Zebra Logo -->
  <div class="logo">
    <img src="logo.jpeg" alt="Zebra Restaurant Logo">
  </div>

  <h1 id="mealHeading">Meal Selection</h1>

  <!-- Section Navigation Menu -->
  <div id="sectionNavigation" class="section-navigation" style="display: none;">
    <div class="nav-title" data-i18n="navigation.quickNavigation">Quick Navigation</div>
    <div id="navButtons" class="nav-buttons"></div>
  </div>

  <div id="mealContainer" class="meal-options"></div>
  <div id="totalPrice"><span data-i18n="order.total">Total</span>: 0 ‚Ç¨</div>

  <div class="action-buttons">
    <button id="resetBtn" onclick="resetAll()" data-i18n="order.reset">Reset</button>
    <button id="continueBtn" disabled onclick="showNextStep()" data-i18n="order.continue">Continue</button>
  </div>

  <div id="locationStep" class="step hidden">
    <div class="section-label" data-i18n="location.whereToEat">Where to eat:</div>
    <div class="location-toggle">
      <button id="roomBtn" onclick="selectLocation('Room')">üóùÔ∏è <span data-i18n="location.room">Room</span></button>
      <button id="restaurantBtn" onclick="selectLocation('Restaurant')">üçΩÔ∏è <span data-i18n="location.restaurant">Restaurant</span></button>
    </div>

    <div id="roomNumberContainer" class="hidden">
      <label><span data-i18n="location.roomNumber">Room Number</span>:</label><br>
      <input type="text" id="roomNumber" readonly data-i18n="room.selectRoom" onclick="showRoomPopup()">
    </div>

    <div class="section-label" data-i18n="location.selectTime">Select Time to Eat / Deliver:</div>
    <div id="timeButtonsContainer" class="time-buttons"></div>
  </div>

  <div id="paymentStep" class="step hidden">
    <div class="payment-label" data-i18n="payment.selectOption">Select payment option</div>
    
    <div class="payment-options" id="paymentOptions">
      <button onclick="showReceiptModal('Cash')" data-i18n="payment.cash">Cash</button>
      <button onclick="showReceiptModal('Card')" data-i18n="payment.card">Card</button>
    </div>
  </div>

  <div id="roomPopup">
    <div class="popup-content">
      <button class="room-close" onclick="closeRoomPopup()" data-i18n="receipt.close">√ó</button>
      <h3 data-i18n="room.selectRoom">Select Room Number</h3>
      <div id="roomGrid" class="room-grid"></div>
    </div>
  </div>

  <div id="receiptModal">
    <div class="receipt-content">
      <button class="receipt-close" onclick="closeReceiptModal()" data-i18n="receipt.close">√ó</button>
      <div class="receipt-header">üßæ <span data-i18n="receipt.orderReceipt">Receipt</span></div>
      <div class="receipt-items" id="receiptItems"></div>
      <div class="receipt-total" id="receiptTotal"></div>
      <div class="receipt-info" id="receiptInfo"></div>
      <div class="pin-section">
        <label for="pinInput"><span style="color: var(--zebra-black); font-weight: bold;" data-i18n="receipt.passToAdmin">Please, pass the device to administrator to complete the order.</span><br><span data-i18n="receipt.adminPin">Admin PIN (2606 for testing)</span>:</label>
        <input type="password" id="pinInput" maxlength="4" placeholder="****" oninput="validatePin(this.value)">
        <div class="error" id="pinError" data-i18n="validation.invalidPin">Incorrect PIN</div>
      </div>
      <button class="receipt-confirm" id="confirmOrderBtn" onclick="confirmAndSendOrder()" disabled data-i18n="receipt.confirmOrder">Confirm Order</button>
    </div>
  </div>

  <!-- Load i18n module -->
  <script src="./i18n.js"></script>
  
  <script>
    const mealContainer = document.getElementById('mealContainer');
    const totalPriceEl = document.getElementById('totalPrice');
    const continueBtn = document.getElementById('continueBtn');
    const locationStep = document.getElementById('locationStep');
    const roomNumberContainer = document.getElementById('roomNumberContainer');
    const roomNumberInput = document.getElementById('roomNumber');
    const paymentBtn = document.getElementById('paymentBtn');
    const paymentOptions = document.getElementById('paymentOptions');
    const timeButtonsContainer = document.getElementById('timeButtonsContainer');
    const roomPopup = document.getElementById('roomPopup');

    // Service Hours Configuration
    const BREAKFAST_START_HOUR = 8;
    const BREAKFAST_START_MINUTE = 30;
    const BREAKFAST_END_HOUR = 12;
    const BREAKFAST_END_MINUTE = 30;
    const DINNER_START_HOUR = 12;
    const DINNER_START_MINUTE = 31;
    const DINNER_END_HOUR = 22;
    const DINNER_END_MINUTE = 30;
    
    // Convert to minutes for easy comparison
    const MINUTES_PER_HOUR = 60; // Minutes conversion factor
    const BREAKFAST_START_MINUTES = BREAKFAST_START_HOUR * MINUTES_PER_HOUR + BREAKFAST_START_MINUTE; // 510
    const BREAKFAST_END_MINUTES = BREAKFAST_END_HOUR * MINUTES_PER_HOUR + BREAKFAST_END_MINUTE; // 750
    const DINNER_START_MINUTES = DINNER_START_HOUR * MINUTES_PER_HOUR + DINNER_START_MINUTE; // 780
    const DINNER_END_MINUTES = DINNER_END_HOUR * MINUTES_PER_HOUR + DINNER_END_MINUTE; // 1350
    const DINNER_SERVICE_END_MINUTES = DINNER_END_HOUR * MINUTES_PER_HOUR + DINNER_END_MINUTE; // 1350 - Service available until 22:30

    // UI Configuration Constants
    const ADMIN_PIN = '2606';
    const TIME_SLOT_INTERVAL = 30; // minutes
    const TIME_SLOTS = [0, 30]; // minute values for time slots
    const CSS_CLASSES = {
      HIDDEN: 'hidden',
      SELECTED: 'selected',
      ACTIVE: 'active',
      DISABLED: 'disabled'
    };
    const DISPLAY_STYLES = {
      FLEX: 'flex',
      BLOCK: 'block',
      NONE: 'none'
    };

    // Telegram Bot Configuration
    const TELEGRAM_CONFIG = {
      BOT_TOKEN: '8071098931:AAFz_EOIJDp7RrJczbimuIE-sZmXnMPjOi0',
      CHAT_ID: '1138899345',
      API_URL: 'https://api.telegram.org/bot'
    };

    // Room Configuration
    const ROOM_FLOORS = [
      { floor: 1, start: 1, end: 6 },   // 101-106
      { floor: 2, start: 1, end: 14 },  // 201-214
      { floor: 3, start: 1, end: 14 },  // 301-314
      { floor: 4, start: 1, end: 14 },  // 401-414
      { floor: 5, start: 1, end: 14 },  // 501-514
      { floor: 6, start: 1, end: 14 },  // 601-614
      { floor: 7, start: 1, end: 14 },  // 701-714
      { floor: 8, start: 1, end: 14 },  // 801-814
      { floor: 9, start: 1, end: 14 },  // 901-914
      { floor: 10, start: 1, end: 14 }, // 1001-1014
      { floor: 11, start: 1, end: 14 }, // 1101-1114
      { floor: 12, start: 1, end: 14 }, // 1201-1214
      { floor: 13, start: 1, end: 3 }   // 1301-1303
    ];

    // Application Messages - Removed, now using i18n system
    // const MESSAGES = { ... };

    // Meal Categories Configuration
    const MEAL_CATEGORIES = {
      BREAKFAST: ['Breakfast Items'],
      DINNER: [
        "Cold appetizers",
        "Salads", 
        "Soup",
        "Risotto",
        "Fish",
        "Meat",
        "Desserts"
      ]
    };

    // Category localization mapping
    const CATEGORY_KEYS = {
      'Breakfast Items': 'meal.categories.breakfastItems',
      'Cold appetizers': 'meal.categories.coldAppetizers',
      'Salads': 'meal.categories.salads',
      'Soup': 'meal.categories.soup',
      'Risotto': 'meal.categories.risotto',
      'Fish': 'meal.categories.fish',
      'Meat': 'meal.categories.meat',
      'Desserts': 'meal.categories.desserts'
    };

    // Helper function to get localized category name
    function getLocalizedCategory(categoryName) {
      const key = CATEGORY_KEYS[categoryName];
      return key ? i18n.t(key, categoryName) : categoryName;
    }

    // Helper functions
    function formatTime12Hour(hour, minute) {
      const period = hour >= 12 ? 'PM' : 'AM';
      const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
      return `${displayHour}:${minute.toString().padStart(2, '0')} ${period}`;
    }

    // Section Navigation Functions
    function createSectionNavigation(isBreakfast) {
      const sectionNav = document.getElementById('sectionNavigation');
      const navButtons = document.getElementById('navButtons');
      
      if (!sectionNav || !navButtons) return;
      
      navButtons.innerHTML = '';
      
      const categories = isBreakfast ? MEAL_CATEGORIES.BREAKFAST : MEAL_CATEGORIES.DINNER;
      
      // Only show navigation if there are multiple categories (for dinner)
      if (!isBreakfast && categories.length > 1) {
        categories.forEach(category => {
          const button = document.createElement('button');
          button.className = 'nav-button';
          button.setAttribute('data-i18n', CATEGORY_KEYS[category]);
          button.textContent = getLocalizedCategory(category);
          button.onclick = () => scrollToSection(category);
          navButtons.appendChild(button);
        });
        sectionNav.style.display = 'block';
      } else {
        sectionNav.style.display = 'none';
      }
    }

    function scrollToSection(categoryName) {
      // Create ID from category name
      const categoryId = `category-${categoryName.toLowerCase().replace(/\s+/g, '-')}`;
      const element = document.getElementById(categoryId);
      
      if (element) {
        element.scrollIntoView({ 
          behavior: 'smooth', 
          block: 'start',
          inline: 'nearest'
        });
      }
    }

    function formatTime24Hour(hour, minute) {
      return `${hour.toString().padStart(2, '0')}.${minute.toString().padStart(2, '0')}`;
    }

    function getWorkingHoursText() {
      const breakfastStart = formatTime12Hour(BREAKFAST_START_HOUR, BREAKFAST_START_MINUTE);
      const breakfastEnd = formatTime12Hour(BREAKFAST_END_HOUR, BREAKFAST_END_MINUTE);
      const dinnerStart = formatTime12Hour(DINNER_START_HOUR, DINNER_START_MINUTE);
      const dinnerEnd = formatTime12Hour(DINNER_END_HOUR, DINNER_END_MINUTE);
      return `Breakfast: ${breakfastStart} - ${breakfastEnd}<br>Dinner: ${dinnerStart} - ${dinnerEnd}`;
    }

    function getServingHoursText(isBreakfast) {
      if (isBreakfast) {
        const start = formatTime24Hour(BREAKFAST_START_HOUR, BREAKFAST_START_MINUTE);
        const end = formatTime24Hour(BREAKFAST_END_HOUR, BREAKFAST_END_MINUTE);
        return `served from ${start} till ${end}`;
      } else {
        const start = formatTime24Hour(DINNER_START_HOUR, DINNER_START_MINUTE);
        const end = formatTime24Hour(DINNER_END_HOUR, DINNER_END_MINUTE);
        return `served from ${start} till ${end}`;
      }
    }
    const roomGrid = document.getElementById('roomGrid');
    const selectedMeals = {};

    const breakfastMeals = [
      { name: "Scramble with shrimp and hoisin cream", desc: "Delicate scrambled eggs with butter, juicy shrimp with a hint of garlic, and a tangy hoisin cream. Served with a mix of greens in a honey-balsamic dressing, cherry tomatoes, and a brioche bun", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/ryTRiQJ-aOFwAiH-TjvYkWa_prepare.jpeg", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/skrembl-s-krevetkoy-i-avokado", translationKey: "scrambleShrimp" },
      { name: "Benedict with bacon and hollandaise sauce", desc: "Delicate English muffin with poached eggs, crispy bacon, and airy hollandaise sauce with a hint of nutmeg. Served with a mix of greens and spicy arugula in a honey-balsamic dressing and cherry tomatoes", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/IgoPOfX-OgMIJbM-HGylJRl.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/yaichnica-glazunya-s-kolbaskami-i-syrom", translationKey: "benedictBacon" },
      { name: "Montenegrian breakfast", desc: "Hearty Balkan-style set: grilled sausages, sunny-side-up eggs, crispy bacon, young potatoes in garlic oil, and farmhouse cheese.", price: 11, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/VBDefRv-fWwMKVy-OQjfLXl.webp", link: "https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/fruktovaya-tarelka", translationKey: "montenegrianBreakfast" },
      { name: "Pancakes with honey and seasonal fruits", desc: "Pancakes with honey and fresh fruits.", price: 7, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/AqINVvH-PeERgoe-OsSIokL.webp", link:"https://zebra.choiceqr.com/takeaway/section:menu/osnovnye-blyuda/syrniki-klubnika-smetana-karamel", translationKey: "pancakesHoney" },
      { name: "Chia pudding", desc: "Chia pudding with homemade granola and nuts (cherry or strawberry of your choice).", price: 8, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/vJklJEJ-hWQFGTA-DvDWfur.webp", link: "", translationKey: "chiaPudding" },
      { name: "Oatmeal", desc: "Oatmeal with baked pear mousse and caramelized hazelnuts.", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/lIhUyGe-cAanBCv-IkjlXFP.webp", link: "", translationKey: "oatmeal" },
      { name: "Chicken sandwich", desc: "Sous-vide chicken sandwich with homemade mayonnaise.", price: 8, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/HdeSvLF-bSovlky-POtnkTF.webp", link: "", translationKey: "chickenSandwich" },
      { name: "French toast", desc: "French toast with seasonal fruits and cherry sauce.", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/aKoJUZC-YzrwyDv-sQEuegd.webp", link: "", translationKey: "frenchToast" }
    ];

    const dinnerMeals = [
      // Cold appetizers - 4 meals
      { name: "Bruschetta with marinated pear, gorgonzola sauce, and smoked salmon", desc: "A delicate combination of sweet pear with a hint of wine, tangy gorgonzola cream with basil, and tender house-cured smoked salmon.", price: 14, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/bkOlGMH-kjnelHM-mfDtHSU.webp", category: "Cold appetizers", translationKey: "bruschettaPear" },
      { name: "Bruschetta with squid, hoisin cream, and chuka seaweed", desc: "Exotic bruschetta with squid, marinated chukka seaweed, mildly sweet hoisin cream, paprika oil and marinated edamame beans", price: 14, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/kPlIlIr-RIoylBS-MdRJeyy.webp", category: "Cold appetizers", translationKey: "bruschettaSquid" },
      { name: "Bruschetta with roast beef and aioli cream", desc: "Juicy roast beef on a crispy toast with a smooth cream rich in roasted garlic aroma, spicy arugula, whole grain mustard, and parmesan", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/klbgUfl-sZAFEqw-ELGpaXb.webp", category: "Cold appetizers", translationKey: "bruschettaBeef" },
      { name: "Beef carpaccio with roasted peach", desc: "Tender slices of beef combined with fragrant peach and a balsamic-based dressing.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/hQJrjLD-FCUeSOl-SwubRJb.webp", category: "Cold appetizers", translationKey: "carpaccioBeef" },
      
      // Salads - 3 meals
      { name: "Salad with roast beef, roasted bell pepper, and pimento sauce", desc: "A salad mix with homemade roast beef, dressed with a sauce made from roasted peppers, sun-dried tomatoes, cilantro, honey and grated roasted walnut.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/gIlCFdO-JqsCDsD-yuVJCVA.webp", category: "Salads", translationKey: "saladRoastBeef" },
      { name: "Seafood salad with coconut dressing", desc: "Young squid and fresh shrimp with a salad mix in a coconut-lime dressing based on mascarpone and paprika oil", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/rHCZwwl-tKeXDxy-JvqnwpH.webp", category: "Salads", translationKey: "saladSeafood" },
      { name: "Seasonal vegetable salad with Pomorosso dressing", desc: "A mix of seasonal vegetables with a signature sun-dried tomato-based dressing. The freshness of the vegetables is balanced by delicate farmhouse feta cheese and piquant notes of the dressing.", price: 8, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/uXGkxVe-EhzYAYC-VkkDRml.webp", category: "Salads", translationKey: "saladVegetable" },
      
      // Soup - 2 meals
      { name: "Fish soup with seafood", desc: "A rich signature-style soup with cilantro and parsley oil, squid, shrimp, and salmon.", price: 13, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/MFCywVG-yDbTKpF-AHdmJzF.webp", category: "Soup", translationKey: "soupFish" },
      { name: "Cold beetroot soup with kefir and baby potatoes", desc: "Refreshing cold kefir-based soup with beetroot, presented in a signature style. Served with saut√©ed young potatoes.", price: 10, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/DznPacA-DkDuqoH-XkKHkMV.webp", category: "Soup", translationKey: "soupBeetroot" },
      
      // Risotto - 3 meals
      { name: "Purple risotto with meatballs and parmesan sauce", desc: "A vibrant dish with veal meatballs, prepared using the classic risotto technique and served with a rich cheese sauce.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/LHnLwxt-rlewSoJ-IiFeJGj.webp", category: "Risotto", translationKey: "risottoPurple" },
      { name: "Risotto with porcini mushrooms", desc: "Creamy risotto in a mushroom broth with porcini mushrooms, parmesan, and dill oil.", price: 14, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/uDvjFrW-lTwPIvh-woGUzqJ.webp", category: "Risotto", translationKey: "risottoMushroom" },
      { name: "Tom Yum risotto with shrimp and squid", desc: "An Asian twist on a classic Italian recipe with squid and shrimp. Infused with coconut notes, lime and the tang of Tom Yum.", price: 16, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/qBCShfD-qVSMPLy-MlyJTPi.webp", category: "Risotto", translationKey: "risottoTomYum" },
      
      // Fish - 3 meals
      { name: "Grilled dorado with vegetable saut√©", desc: "Tender grilled dorado paired with a crispy saut√© of seasonal vegetables.", price: 25, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/oWXFZBg-QVTFAYS-YVlSlOX.webp", category: "Fish", translationKey: "fishDorado" },
      { name: "Sea bass fillet with celery root cream and Basoro sauce", desc: "Tender sea bass fillet, pan-seared to a golden crust, served on a velvety celery cream with refined Basoro sauce made from white wine, orange, and aromatic spices. Marinated fennel adds the necessary freshness to the dish.", price: 23, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/iIukBbz-aGWrkjI-FxqSzNR.webp", category: "Fish", translationKey: "fishSeaBass" },
      { name: "Bourbon salmon", desc: "Tender salmon fillet with mashed potatoes and a sweet-and-sour sauce made from bourbon, honey, and chili pepper.", price: 17, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/CDbjitD-DTYXssC-IwVErjL.webp", category: "Fish", translationKey: "fishSalmon" },
      
      // Meat - 4 meals
      { name: "Beef medallions with mashed potatoes and porcini mushroom sauce", desc: "Juicy beef medallions with tender mashed potatoes and a rich creamy sauce made from aromatic wild mushrooms and thyme.", price: 24, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/IzKbeVG-VuCjJFC-XAhJoAT.webp", category: "Meat", translationKey: "meatBeefMedallions" },
      { name: "Sous-vide chicken with egg noodles and anise teriyaki sauce", desc: "Juicy sous-vide chicken fillet served with egg noodles in a signature anise teriyaki sauce.", price: 15, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/OebmNKU-FJYnCSH-RbAeXIC.webp", category: "Meat", translationKey: "meatChicken" },
      { name: "Pork tenderloin with young potatoes and mashroom sauce", desc: "Tender, juicy pork with roasted young potatoes. Served with mushroom sauce.", price: 17, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/MTDKfku-iJCHCgl-GjEcePk.webp", category: "Meat", translationKey: "meatPork" },
      { name: "Signature Pljeskavitsa", desc: "A Balkan classic made from a blend of beef and spices, grilled to perfection. Served with homemade pickles and French fries.", price: 15, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/QrinGlH-oDvCCcR-DMymsiH.webp", category: "Meat", translationKey: "meatPljeskavitsa" },
      
      // Desserts - 2 meals
      { name: "Brownie with dulce de leche cream and caramelized hazelnuts", desc: "Rich chocolate brownie with the most delicate cream made from boiled condensed milk, soaked cherries, and caramelized hazelnuts.", price: 9, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/GRCFMgJ-WVZeYDn-wbmdTQY.webp", category: "Desserts", translationKey: "dessertBrownie" },
      { name: "Tiramisu", desc: "A classic Italian dessert. Airy mascarpone cream with notes of lime and orange, sponge cake soaked in coffee and amaretto.", price: 9, img: "https://cdn-media.choiceqr.com/prod-eat-zebra/menu/zDiykLg-VklFnkh-BLUdtTz.webp", category: "Desserts", translationKey: "dessertTiramisu" }
    ];

    function selectLocation(location) {
      // Update button states
      const roomBtn = document.getElementById('roomBtn');
      const restaurantBtn = document.getElementById('restaurantBtn');
      
      roomBtn.classList.toggle('active', location === 'Room');
      restaurantBtn.classList.toggle('active', location === 'Restaurant');
      
      // Store selected location
      window.selectedLocation = location;
      
      // Show/hide room selection
      const showRoom = location === 'Room';
      roomNumberContainer.classList.toggle("hidden", !showRoom);
      if (showRoom) showRoomPopup();
      
      checkForPayment();
    }

    function showRoomPopup() {
      roomPopup.style.display = "flex";
    }

    function closeRoomPopup() {
      roomPopup.style.display = "none";
    }

    function toggleDescription(descriptionElement) {
      descriptionElement.classList.toggle('expanded');
    }

    function selectRoom(number) {
      roomNumberInput.value = number;
      closeRoomPopup();
      checkForPayment();
    }

    function loadRoomButtons() {
      // Use the centralized room configuration
      ROOM_FLOORS.forEach(range => {
        for (let i = range.start; i <= range.end; i++) {
          const roomNumber = range.floor * 100 + i;
          const btn = document.createElement('button');
          btn.textContent = roomNumber;
          btn.onclick = () => selectRoom(roomNumber);
          roomGrid.appendChild(btn);
        }
      });
    }

    function updateQuantity(name, price, action, button) {
      const quantitySpan = button.parentElement.querySelector('.quantity');
      let value = parseInt(quantitySpan.textContent);
      
      if (action === 'increase' && value < 5) {
        value++;
      } else if (action === 'decrease' && value > 0) {
        value--;
      }
      
      quantitySpan.textContent = value;
      
      if (value > 0) {
        selectedMeals[name] = { qty: value, price };
      } else {
        delete selectedMeals[name];
      }

      updateTotalDisplay(); // Use the new function that respects current language
      
      let total = 0;
      for (let item of Object.values(selectedMeals)) {
        total += item.qty * item.price;
      }
      continueBtn.disabled = total === 0;
    }

    function showNextStep() {
      locationStep.classList.remove('hidden');
      // Select Restaurant by default
      selectLocation('Restaurant');
      window.scrollTo({ top: locationStep.offsetTop, behavior: "smooth" });
    }

    function checkForPayment() {
      const location = window.selectedLocation;
      const room = roomNumberInput.value;
      const selectedTime = document.querySelector('.time-buttons button.selected');
      const paymentStep = document.getElementById('paymentStep');
      const paymentOptions = document.getElementById('paymentOptions');

      const ready = location && selectedTime && (
        location === "Restaurant" || (location === "Room" && room.trim() !== "")
      );

      if (ready) {
        // Show the entire payment section with all buttons visible
        paymentStep.classList.remove('hidden');
        paymentOptions.classList.remove('hidden');
        // Scroll to the payment step
        setTimeout(() => {
          paymentStep.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
          });
        }, 100);
      } else {
        // Hide payment step if conditions are not met
        paymentStep.classList.add('hidden');
        paymentOptions.classList.add('hidden');
      }
    }

    function showPaymentStep() {
      const paymentStep = document.getElementById('paymentStep');
      paymentStep.classList.remove("hidden");
      window.scrollTo({ top: paymentStep.offsetTop, behavior: "smooth" });
    }



    function validatePin(value) {
      const confirmBtn = document.getElementById('confirmOrderBtn');
      const pinError = document.getElementById('pinError');
      
      if (value === ADMIN_PIN) {
        confirmBtn.disabled = false;
        pinError.style.display = DISPLAY_STYLES.NONE;
      } else {
        confirmBtn.disabled = true;
        if (value.length === 4) {
          pinError.style.display = DISPLAY_STYLES.BLOCK;
        } else {
          pinError.style.display = DISPLAY_STYLES.NONE;
        }
      }
    }

    function generateOrderNumber() {
      const timestamp = Date.now();
      return `ORDER-${timestamp}`;
    }

    function showReceiptModal(method) {
      const receiptModal = document.getElementById('receiptModal');
      const receiptItems = document.getElementById('receiptItems');
      const receiptTotal = document.getElementById('receiptTotal');
      const receiptInfo = document.getElementById('receiptInfo');
      const pinInput = document.getElementById('pinInput');
      const confirmBtn = document.getElementById('confirmOrderBtn');
      const pinError = document.getElementById('pinError');

      // Generate unique order number
      const orderNumber = generateOrderNumber();

      // Reset PIN input and button state
      pinInput.value = '';
      confirmBtn.disabled = true;
      pinError.style.display = DISPLAY_STYLES.NONE;
      
      // Clear previous content
      receiptItems.innerHTML = '';
      
      // Add order number at the top
      receiptItems.innerHTML = `<div style="font-weight: bold; margin-bottom: 10px;">${i18n.t('receipt.orderReceipt')} #: ${orderNumber}</div>`;
      
      // Add items
      let total = 0;
      for (let [name, item] of Object.entries(selectedMeals)) {
        const itemTotal = item.qty * item.price;
        total += itemTotal;
        receiptItems.innerHTML += `<div>${name} x${item.qty} = ${itemTotal} ‚Ç¨</div>`;
      }
      
      // Add total
      receiptTotal.textContent = `${i18n.t('order.total')}: ${total} ‚Ç¨`;
      
      // Add info
      const time = document.querySelector('.time-buttons button.selected')?.textContent || "N/A";
      const location = window.selectedLocation || "N/A";
      const room = location === "Room" ? roomNumberInput.value : "N/A";
      
      receiptInfo.innerHTML = `
        <div><strong>${i18n.t('receipt.deliveryTime')}:</strong> ${time}</div>
        <div><strong>${i18n.t('receipt.location')}:</strong> ${location}</div>
        ${location === "Room" ? `<div><strong>${i18n.t('location.room')}:</strong> ${room}</div>` : ''}
        <div><strong>${i18n.t('receipt.paymentMethod')}:</strong> ${method}</div>
        ${i18n.getCurrentLanguage() !== 'en' ? `
          <hr style="margin: 1rem 0; border: 1px solid var(--zebra-gray);">
          <div style="color: var(--zebra-gray); font-size: 0.9em;">
            <div><strong>Delivery Time:</strong> ${time}</div>
            <div><strong>Location:</strong> ${location}</div>
            ${location === "Room" ? `<div><strong>Room:</strong> ${room}</div>` : ''}
            <div><strong>Payment Method:</strong> ${method}</div>
          </div>
        ` : ''}
      `;
      
      // Store the receipt data for later use when sending to Telegram
      receiptModal.dataset.receipt = JSON.stringify({
        orderNumber,
        items: selectedMeals,
        total,
        time,
        location,
        room,
        method
      });
      
      // Show modal
      receiptModal.style.display = 'flex';
    }
    
    function closeReceiptModal() {
      const receiptModal = document.getElementById('receiptModal');
      const pinInput = document.getElementById('pinInput');
      const pinError = document.getElementById('pinError');
      const confirmBtn = document.getElementById('confirmOrderBtn');
      
      receiptModal.style.display = 'none';
      pinInput.value = '';
      pinError.style.display = 'none';
      confirmBtn.disabled = true;
    }
    
    function confirmAndSendOrder() {
      const receiptModal = document.getElementById('receiptModal');
      const receiptData = JSON.parse(receiptModal.dataset.receipt);
      
      // Format receipt for Telegram (always in English)
      let receipt = `üßæ Receipt\nOrder #: ${receiptData.orderNumber}\n\n`;
      for (let [name, item] of Object.entries(receiptData.items)) {
        receipt += `${name} x${item.qty} = ${item.qty * item.price} ‚Ç¨\n`;
      }
      receipt += `\nTotal: ${receiptData.total} ‚Ç¨`;
      receipt += `\nDelivery Time: ${receiptData.time}`;
      receipt += `\nLocation: ${receiptData.location}`;
      if (receiptData.location === "Room") receipt += `\nRoom: ${receiptData.room}`;
      receipt += `\nPayment Method: ${receiptData.method}`;
      
      // Close modal
      closeReceiptModal();
      
      // Send to Telegram
      const BOT_TOKEN = TELEGRAM_CONFIG.BOT_TOKEN;
      const CHAT_ID = TELEGRAM_CONFIG.CHAT_ID;
      
      fetch(`${TELEGRAM_CONFIG.API_URL}${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          chat_id: CHAT_ID,
          text: receipt,
          parse_mode: 'HTML',
          reply_markup: JSON.stringify({
            inline_keyboard: [
              [{
                text: '‚úÖ Confirm Order',
                callback_data: 'confirm_order'
              }],
              [{
                text: '‚ùå Reject Order',
                callback_data: 'reject_order'
              }]
            ]
          })
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          alert(i18n.t('order.sendSuccess'));
          // Reset the page after successful order
          resetAll();
        } else {
          alert(i18n.t('order.sendError'));
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert(i18n.t('order.sendError'));
      });
    }

    function loadTimeButtons() {
      const now = new Date();
      const currentHour = now.getHours();
      const currentMinute = now.getMinutes();
      const currentTotalMinutes = currentHour * MINUTES_PER_HOUR + currentMinute;
      
      // Define breakfast time slots using constants
      const breakfastSlots = [];
      for (let h = BREAKFAST_START_HOUR; h <= BREAKFAST_END_HOUR; h++) {
        for (let m of TIME_SLOTS) {
          if (h === BREAKFAST_START_HOUR && m === 0) continue; // Skip 8:00, start from 8:30
          if (h === BREAKFAST_END_HOUR && m === BREAKFAST_END_MINUTE) {
            breakfastSlots.push({ hour: h, minute: m, minutes: h * MINUTES_PER_HOUR + m });
            break; // Include end time and stop
          }
          breakfastSlots.push({ hour: h, minute: m, minutes: h * MINUTES_PER_HOUR + m });
        }
      }
      
      // Define dinner time slots using constants
      const dinnerSlots = [];
      for (let h = DINNER_START_HOUR; h <= DINNER_END_HOUR; h++) {
        for (let m of TIME_SLOTS) {
          // For the first hour (12pm), only include the time if it's >= DINNER_START_MINUTE (31)
          if (h === DINNER_START_HOUR && m < DINNER_START_MINUTE) continue;
          
          if (h === DINNER_END_HOUR && m === DINNER_END_MINUTE) {
            dinnerSlots.push({ hour: h, minute: m, minutes: h * MINUTES_PER_HOUR + m });
            break; // Include end time and stop
          }
          dinnerSlots.push({ hour: h, minute: m, minutes: h * MINUTES_PER_HOUR + m });
        }
      }
      
      // Add the specific 12:31 time slot
      if (DINNER_START_MINUTE !== 0 && DINNER_START_MINUTE !== 30) {
        dinnerSlots.unshift({ 
          hour: DINNER_START_HOUR, 
          minute: DINNER_START_MINUTE, 
          minutes: DINNER_START_HOUR * MINUTES_PER_HOUR + DINNER_START_MINUTE 
        });
      }
      
      // Determine which slots to show based on current time
      const isCurrentlyBreakfast = currentTotalMinutes >= BREAKFAST_START_MINUTES && currentTotalMinutes <= BREAKFAST_END_MINUTES;
      const isCurrentlyDinner = currentTotalMinutes >= DINNER_START_MINUTES && currentTotalMinutes <= DINNER_SERVICE_END_MINUTES;
      
      let slotsToShow = [];
      if (isCurrentlyBreakfast) {
        slotsToShow = breakfastSlots;
      } else if (isCurrentlyDinner) {
        slotsToShow = dinnerSlots;
      } else {
        // Outside service hours - show no slots
        return;
      }
      
      slotsToShow.forEach(slot => {
        const timeStr = `${slot.hour.toString().padStart(2, '0')}:${slot.minute.toString().padStart(2, '0')}`;
        const btn = document.createElement('button');
        btn.textContent = timeStr;
        
        // Disable if time has passed
        const timePassed = slot.minutes <= currentTotalMinutes;
        
        if (timePassed) {
          btn.disabled = true;
          btn.style.opacity = '0.5';
          btn.style.cursor = 'not-allowed';
        } else {
          btn.onclick = () => {
            // Check if location is selected first
            if (!window.selectedLocation) {
              // Shake the location selector to indicate missing selection
              const locationToggle = document.querySelector('.location-toggle');
              locationToggle.classList.add('shake');
              setTimeout(() => {
                locationToggle.classList.remove('shake');
              }, 800);
              return;
            }
            
            // If room is selected, check if room number is provided
            if (window.selectedLocation === 'Room') {
              const roomInput = document.getElementById('roomNumber');
              if (!roomInput.value.trim()) {
                // Shake the location selector to indicate missing room selection
                const locationToggle = document.querySelector('.location-toggle');
                locationToggle.classList.add('shake');
                setTimeout(() => {
                  locationToggle.classList.remove('shake');
                }, 800);
                // Also show the room popup if not visible
                showRoomPopup();
                return;
              }
            }
            
            // Proceed with time selection
            document.querySelectorAll('.time-buttons button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            checkForPayment();
          };
        }
        
        timeButtonsContainer.appendChild(btn);
      });
    }

    function resetAll() {
      // Reset meal selections
      const quantitySpans = document.querySelectorAll('.quantity-control .quantity');
      quantitySpans.forEach(span => {
        span.textContent = '0';
        const optionDiv = span.closest('.option');
        const name = optionDiv.querySelector('.option-title').textContent;
        const price = parseFloat(optionDiv.querySelector('.price').textContent);
        delete selectedMeals[name];
      });

      // Reset location selection
      const roomBtn = document.getElementById('roomBtn');
      const restaurantBtn = document.getElementById('restaurantBtn');
      if (roomBtn) roomBtn.classList.remove('active');
      if (restaurantBtn) restaurantBtn.classList.remove('active');
      window.selectedLocation = null;

      // Reset room number
      if (roomNumberInput) {
        roomNumberInput.value = '';
        roomNumberContainer.classList.add('hidden');
      }

      // Reset time selection
      const timeButtons = document.querySelectorAll('.time-buttons button');
      timeButtons.forEach(btn => btn.classList.remove('selected'));

      // Hide subsequent steps
      locationStep.classList.add('hidden');
      paymentStep.classList.add('hidden');

      // Reset total price
      updateTotalDisplay(); // Use the new function for consistency
      
      // Disable continue button
      continueBtn.disabled = true;

      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function loadMeals() {
      // Check if i18n is properly initialized
      if (!window.i18n || !window.i18n.translations || Object.keys(window.i18n.translations).length === 0) {
        console.warn('i18n not ready, delaying loadMeals');
        setTimeout(loadMeals, 100);
        return;
      }
      
      // Clear existing content to prevent duplicates
      mealContainer.innerHTML = '';
      
      const now = new Date();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();

      // Check service availability using constants
      const isBreakfast = currentMinutes >= BREAKFAST_START_MINUTES && currentMinutes <= BREAKFAST_END_MINUTES;
      const isDinner = currentMinutes >= DINNER_START_MINUTES && currentMinutes <= DINNER_SERVICE_END_MINUTES;
      
      const totalPriceEl = document.getElementById('totalPrice');
      const actionButtons = document.querySelector('.action-buttons');
      const locationStep = document.getElementById('locationStep');
      const paymentStep = document.getElementById('paymentStep');
      
      if (!isBreakfast && !isDinner) {
        // Hide all interactive elements during off-hours
        if (totalPriceEl) totalPriceEl.style.display = 'none';
        if (actionButtons) actionButtons.style.display = 'none';
        if (locationStep) locationStep.classList.add('hidden');
        if (paymentStep) paymentStep.classList.add('hidden');
        
        const mealHeading = document.getElementById("mealHeading");
        mealHeading.innerHTML = 'Meal Selection';
        
        mealContainer.innerHTML = `<p style='text-align: center; font-size: 1.1rem; color: var(--zebra-gray); margin: 2rem 0; padding: 1rem;'>${i18n.t('meal.unavailable')}<br><br><strong>${i18n.t('meal.workingHours')}</strong><br>${getWorkingHoursText()}</p>`;
        return;
      }

      // Show interactive elements during service hours
      if (totalPriceEl) totalPriceEl.style.display = 'block';
      if (actionButtons) actionButtons.style.display = 'flex';

      const mealHeading = document.getElementById("mealHeading");
      if (isBreakfast) {
        mealHeading.innerHTML = `${i18n.t('meal.selectBreakfast')}<br><small style='font-size: 0.6em; color: var(--zebra-gray); font-weight: 400;'>${getServingHoursText(true)}</small>`;
      } else {
        mealHeading.innerHTML = `${i18n.t('meal.selectMeal')}<br><small style='font-size: 0.6em; color: var(--zebra-gray); font-weight: 400;'>${getServingHoursText(false)}</small>`;
      }

      // Create section navigation
      createSectionNavigation(isBreakfast);

      if (isBreakfast) {
        // Load breakfast meals as before
        breakfastMeals.forEach(item => {
          const div = document.createElement('div');
          div.className = 'option';
          
              // Get translated name and description using translationKey
              let itemName = item.name; // fallback
              let itemDesc = item.desc; // fallback
              
              if (item.translationKey) {
                const nameKey = `meals.breakfast.${item.translationKey}.name`;
                const descKey = `meals.breakfast.${item.translationKey}.desc`;
                const translatedName = i18n.t(nameKey);
                const translatedDesc = i18n.t(descKey);
                
                // Only use translation if it's not the same as the key (meaning translation was found)
                itemName = (translatedName && translatedName !== nameKey) ? translatedName : item.name;
                itemDesc = (translatedDesc && translatedDesc !== descKey) ? translatedDesc : item.desc;
              }          const imgHTML = item.link
            ? `<img src="${item.img}" alt="${itemName}" onclick="window.open('${item.link}', '_blank')">`
            : `<img src="${item.img}" alt="${itemName}">`;
          div.innerHTML = `
            ${imgHTML}
            <div class="option-title">${itemName}</div>
            <div class="description" onclick="toggleDescription(this)">${itemDesc}</div>
            <div class="price">${item.price} ‚Ç¨</div>
            <div class="quantity-control">
              <button onclick="updateQuantity('${item.name}', ${item.price}, 'decrease', this)">‚àí</button>
              <span class="quantity">0</span>
              <button onclick="updateQuantity('${item.name}', ${item.price}, 'increase', this)">+</button>
            </div>
          `;
          mealContainer.appendChild(div);
        });
      } else {
        // Load dinner meals organized by categories
        const categories = MEAL_CATEGORIES.DINNER;
        
        categories.forEach(category => {
          const categoryItems = dinnerMeals.filter(item => item.category === category);
          
          if (categoryItems.length > 0) {
            // Add category header
            const categoryHeader = document.createElement('div');
            categoryHeader.id = `category-${category.toLowerCase().replace(/\s+/g, '-')}`;
            categoryHeader.className = 'category-header';
            categoryHeader.setAttribute('data-i18n', CATEGORY_KEYS[category]);
            categoryHeader.style.cssText = `
              grid-column: 1 / -1;
              font-size: 1.5rem;
              font-weight: 700;
              color: var(--zebra-accent);
              text-align: center;
              margin: 2rem 0 1rem 0;
              padding: 1rem;
              background: var(--zebra-white);
              border-radius: var(--radius-lg);
              box-shadow: var(--shadow-sm);
              scroll-margin-top: 100px;
            `;
            categoryHeader.textContent = getLocalizedCategory(category);
            mealContainer.appendChild(categoryHeader);
            
            // Add items in this category
            categoryItems.forEach(item => {
              const div = document.createElement('div');
              div.className = 'option';
              
              // Get translated name and description using translationKey
              let itemName = item.name; // fallback
              let itemDesc = item.desc; // fallback
              
              if (item.translationKey) {
                const nameKey = `meals.dinner.${item.translationKey}.name`;
                const descKey = `meals.dinner.${item.translationKey}.desc`;
                const translatedName = i18n.t(nameKey);
                const translatedDesc = i18n.t(descKey);
                
                // Only use translation if it's not the same as the key (meaning translation was found)
                itemName = (translatedName && translatedName !== nameKey) ? translatedName : item.name;
                itemDesc = (translatedDesc && translatedDesc !== descKey) ? translatedDesc : item.desc;
              }
              
              const imgHTML = item.link
                ? `<img src="${item.img}" alt="${itemName}" onclick="window.open('${item.link}', '_blank')">`
                : `<img src="${item.img}" alt="${itemName}">`;
              div.innerHTML = `
                ${imgHTML}
                <div class="option-title">${itemName}</div>
                <div class="description" onclick="toggleDescription(this)">${itemDesc}</div>
                <div class="price">${item.price} ‚Ç¨</div>
                <div class="quantity-control">
                  <button onclick="updateQuantity('${item.name}', ${item.price}, 'decrease', this)">‚àí</button>
                  <span class="quantity">0</span>
                  <button onclick="updateQuantity('${item.name}', ${item.price}, 'increase', this)">+</button>
                </div>
              `;
              mealContainer.appendChild(div);
            });
          }
        });
      }
    }

    loadTimeButtons();
    loadRoomButtons();

    // Language switching function
    async function switchLanguage(language) {
      await i18n.switchLanguage(language);
      loadMeals(); // Refresh meals with new language (includes navigation)
      updateTotalDisplay(); // Update total price label with new language
      
      // Update language selector
      const languageSelect = document.getElementById('languageSelect');
      languageSelect.value = language;
    }

    // Function to update total display with current language
    function updateTotalDisplay() {
      let total = 0;
      for (let item of Object.values(selectedMeals)) {
        total += item.qty * item.price;
      }
      totalPriceEl.textContent = `${i18n.t('order.total')}: ${total} ‚Ç¨`;
    }

    // Initialize i18n system
    document.addEventListener('DOMContentLoaded', async () => {
      await i18n.init();
      // Set the language selector to current language
      const languageSelect = document.getElementById('languageSelect');
      languageSelect.value = i18n.getCurrentLanguage();
      // Refresh the page content after i18n is loaded
      loadMeals();
    });

  
  </script>

  <!-- Language Selector -->
  <div class="language-selector" style="position: fixed; top: 10px; right: 10px; z-index: 1000;">
    <select id="languageSelect" onchange="switchLanguage(this.value)" style="padding: 1rem 1.5rem; font-size: 1.1rem; border-radius: 8px; border: 2px solid var(--zebra-accent); background: var(--zebra-white); color: var(--zebra-accent); min-width: 180px; cursor: pointer;">
      <option value="en">üá∫üá∏ English</option>
      <option value="de">üá©üá™ Deutsch</option>
      <option value="fr">üá´üá∑ Fran√ßais</option>
      <option value="sr">üá∑üá∏ –°—Ä–ø—Å–∫–∏</option>
      <option value="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</option>
      <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π</option>
      <option value="he">üáÆüá± ◊¢◊ë◊®◊ô◊™</option>
    </select>
  </div>

  <!-- Version Display -->
  <div class="version-info" id="appVersion">
    v1.0.0
  </div>

  <script>
    // Load version from package.json
    async function loadVersion() {
      try {
        const response = await fetch('./package.json');
        const packageData = await response.json();
        document.getElementById('appVersion').textContent = `v${packageData.version}`;
      } catch (error) {
        console.log('Could not load version from package.json');
      }
    }
    loadVersion();
  </script>

</body>
</html>
